typeof toastr<"u"&&(toastr.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!0,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"});function ce(e){const t=document.createElement("div");return t.textContent=e??"",t.innerHTML}function Et(){document.querySelectorAll(".icone-notificacao").forEach(a=>{a.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation();const s=document.querySelector(".menu-lateral");s&&s.classList.contains("ativo")&&typeof fecharMenuLateral=="function"&&fecharMenuLateral(),Ne()})});const t=document.getElementById("fechar-notificacoes");t&&t.addEventListener("click",function(a){a.preventDefault(),P()});const o=document.getElementById("marcar-todas-lidas");o&&o.addEventListener("click",function(a){a.preventDefault(),Re()}),z(),setInterval(z,6e4)}function Ne(){const e=document.getElementById("painel-notificacoes");if(!e){console.error("Painel de notificações não encontrado!");return}e.classList.contains("ativo")?P():Me()}function Me(){const e=document.getElementById("painel-notificacoes");if(!e){console.error("Painel de notificações não encontrado!");return}e.style.display="block",e.style.visibility="visible",e.style.opacity="1",e.classList.add("ativo");const t=document.getElementById("carregando-notificacoes"),o=document.getElementById("lista-notificacoes"),a=document.getElementById("sem-notificacoes");t&&(t.style.display="flex"),o&&(o.style.display="none"),a&&(a.style.display="none"),setTimeout(ze,100),setTimeout(function(){document.addEventListener("click",De)},100)}function P(){const e=document.getElementById("painel-notificacoes");e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.classList.remove("ativo"),document.removeEventListener("click",De))}function De(e){const t=document.getElementById("painel-notificacoes"),o=document.querySelector(".icone-notificacao");t&&!t.contains(e.target)&&(!o||!o.contains(e.target))&&P()}function z(){const e=document.getElementById("usuarioId")?.value;!e||e==="0"||fetch("/api/Notificacao/nao-lidas",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"}).then(t=>{if(!t.ok)throw new Error("Falha ao obter notificações");return t.json()}).then(t=>{bt(t)}).catch(t=>{console.error("Erro ao verificar notificações:",t),Fe()})}function bt(e){document.querySelectorAll(".contador-notificacoes").forEach(o=>{e>0?(o.textContent=e,o.style.display="flex",document.querySelectorAll(".sino-svg").forEach(n=>{n.classList.add("animacao-sino")})):(o.style.display="none",document.querySelectorAll(".sino-svg").forEach(n=>{n.classList.remove("animacao-sino")}))})}function Fe(){document.querySelectorAll(".contador-notificacoes").forEach(o=>{o.style.display="none"}),document.querySelectorAll(".sino-svg").forEach(o=>{o.classList.remove("animacao-sino")})}function ze(){const e=document.getElementById("carregando-notificacoes"),t=document.getElementById("lista-notificacoes"),o=document.getElementById("sem-notificacoes");t&&fetch("/api/Notificacao",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"}).then(a=>{if(!a.ok)throw new Error("Falha ao obter notificações");return a.json()}).then(a=>{e&&(e.style.display="none"),a&&a.length>0?(t.innerHTML="",a.forEach(n=>{t.appendChild(It(n))}),t.style.display="block",o&&(o.style.display="none")):(t&&(t.style.display="none"),o&&(o.style.display="flex"))}).catch(a=>{console.error("Erro ao carregar notificações:",a),e&&(e.style.display="none"),t&&(t.style.display="none"),o&&(o.style.display="flex"),o.innerHTML='<i class="fas fa-exclamation-triangle"></i><p>Erro ao carregar notificações</p>'})}function It(e){const t=new Date(e.dataCriacao),o=Lt(t),a=document.createElement("div");return a.className=`notificacao ${e.lida?"":"notificacao-nao-lida"}`,a.setAttribute("data-id",e.id),a.style.padding="15px 20px",a.style.borderBottom="1px solid rgba(0,0,0,0.05)",a.style.cursor="pointer",a.style.transition="all 0.2s ease",a.style.backgroundColor="white",a.style.width="100%",a.style.boxSizing="border-box",a.style.position="relative",a.innerHTML=`
        <h4 style="margin: 0; font-size: 1rem; color: #333; font-weight: 600; margin-bottom: 5px;">${ce(e.titulo||"Notificação")}</h4>
        <p style="margin: 0 0 5px 0; font-size: 0.9rem; color: #555; line-height: 1.5;">${ce(e.mensagem||"")}</p>
        <small style="color: #999; font-size: 0.8rem;">Há ${o}</small>
    `,a.addEventListener("click",function(){const n=this.getAttribute("data-id");n&&!e.lida&&(Ct(n),this.classList.remove("notificacao-nao-lida"))}),a}function Lt(e){const o=new Date-e,a=Math.floor(o/1e3),n=Math.floor(a/60),s=Math.floor(n/60),i=Math.floor(s/24);return a<60?"agora":n<60?`${n} ${n===1?"minuto":"minutos"}`:s<24?`${s} ${s===1?"hora":"horas"}`:i<7?`${i} ${i===1?"dia":"dias"}`:`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`}function Ct(e){fetch(`/api/Notificacao/marcar-como-lida/${e}`,{method:"POST",credentials:"include"}).then(t=>{if(!t.ok)throw new Error("Falha ao marcar notificação como lida");z()}).catch(t=>{console.error("Erro ao marcar notificação como lida:",t)})}function Re(){fetch("/api/Notificacao/marcar-todas-como-lidas",{method:"POST",credentials:"include"}).then(e=>{if(!e.ok)throw new Error("Falha ao marcar todas notificações como lidas");document.querySelectorAll(".item-notificacao").forEach(o=>{o.classList.remove("notificacao-nao-lida")}),Fe(),z()}).catch(e=>{console.error("Erro ao marcar todas notificações como lidas:",e),wt("Erro ao marcar notificações como lidas","error")})}function wt(e,t){if(typeof toastr<"u")switch(t){case"success":toastr.success(e);break;case"error":toastr.error(e);break;default:toastr.info(e)}else alert(e)}document.addEventListener("DOMContentLoaded",function(){Et()});function Oe(){const e=document.querySelector(".menu-lateral"),t=document.querySelector(".menu-sobreposicao"),o=document.getElementById("btnMenuHamburguer");e&&e.classList.add("ativo"),t&&t.classList.add("ativo"),o&&o.classList.add("ativo"),St()}function R(){const e=document.querySelector(".menu-lateral"),t=document.querySelector(".menu-sobreposicao"),o=document.getElementById("btnMenuHamburguer");e&&e.classList.remove("ativo"),t&&t.classList.remove("ativo"),o&&o.classList.remove("ativo")}function He(){const e=document.querySelector(".menu-lateral"),t=document.querySelector(".menu-sobreposicao");document.getElementById("btnMenuHamburguer"),e&&t?e.classList.contains("ativo")?R():Oe():console.error("[SLIDEBAR] Elementos do menu não encontrados")}function St(){const e=document.getElementById("painel-notificacoes");e&&(e.classList.contains("ativo")||e.style.display==="block")&&(typeof P=="function"?P():(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.classList.remove("ativo")))}function _e(){fetch("/Autenticacao/Logout",{method:"GET",credentials:"include"}).then(e=>{e.ok||e.redirected?window.location.href="/Home/Index":(console.error("Erro ao fazer logout"),alert("Ocorreu um erro ao fazer logout. Por favor, tente novamente."))}).catch(e=>{console.error("Erro ao fazer logout:",e),alert("Ocorreu um erro ao fazer logout. Por favor, tente novamente.")})}document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".icone-notificacao");e&&e.addEventListener("click",function(){});const t=document.querySelector('a[href="/Autenticacao/Logout"]');t&&t.addEventListener("click",function(n){n.preventDefault(),_e()});const o=document.getElementById("btnMenuHamburguer"),a=document.querySelector(".menu-sobreposicao");o&&!o.hasAttribute("onclick")&&o.addEventListener("click",He),a&&!a.hasAttribute("onclick")&&a.addEventListener("click",R),document.addEventListener("keydown",function(n){if(n.key==="Escape"){const s=document.querySelector(".menu-lateral");s&&s.classList.contains("ativo")&&R()}})});function $t(){const e=document.querySelector(".sidebar");e&&e.classList.toggle("active")}document.addEventListener("click",function(e){const t=document.querySelector(".sidebar"),o=document.querySelector(".navbar-toggler");t&&t.classList.contains("active")&&!t.contains(e.target)&&!o.contains(e.target)&&t.classList.remove("active")});document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".navbar");if(e){const t=document.createElement("button");t.className="btn btn-link d-lg-none",t.innerHTML='<i class="fas fa-bars"></i>',t.onclick=$t;const o=e.querySelector(".navbar-toggler");o&&o.parentNode.insertBefore(t,o)}});window.addEventListener("resize",function(){const e=document.querySelector(".sidebar");e&&window.innerWidth>=992&&e.classList.remove("active")});document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".menu-hamburguer"),t=document.querySelector(".menu-lateral"),o=document.querySelector(".menu-sobreposicao"),a=document.querySelector(".icone-notificacao"),n=document.querySelector(".sino-svg"),s=document.querySelector(".contador-notificacoes");if(document.querySelector(".ponto-pulsante"),document.querySelector(".logo-link"),document.querySelector(".pata-svg"),n&&s&&n.classList.add("animacao-sino"),e&&t&&o&&(t.classList.remove("ativo"),o.classList.remove("ativo"),e.addEventListener("click",function(l){l.preventDefault(),T()}),o.addEventListener("click",function(){T()}),document.addEventListener("keydown",function(l){l.key==="Escape"&&t.classList.contains("ativo")&&T()})),a){const l=a.cloneNode(!0);a.parentNode&&a.parentNode.replaceChild(l,a),l.addEventListener("click",function(d){d.preventDefault(),d.stopPropagation();const u=this.querySelector(".sino-svg");u&&(u.classList.add("animacao-sino"),setTimeout(function(){u.classList.remove("animacao-sino")},1500)),Bt()})}const i=document.querySelector(".overlay-notificacoes");i&&i.addEventListener("click",function(){L()});const r=document.querySelector(".fechar-painel");r&&r.addEventListener("click",function(l){l.preventDefault(),L()});const c=document.getElementById("fechar-notificacoes");c&&c.addEventListener("click",function(l){l.preventDefault(),L()}),document.addEventListener("keydown",function(l){if(l.key==="Escape"){const d=document.getElementById("painel-notificacoes");d&&(d.classList.contains("ativo")||d.style.display==="block")&&L()}}),document.addEventListener("click",function(l){const d=document.getElementById("painel-notificacoes"),u=document.querySelector(".icone-notificacao");d&&(d.classList.contains("ativo")||d.style.display==="block")&&!d.contains(l.target)&&(!u||!u.contains(l.target))&&L()})});function T(){const e=document.querySelector(".menu-hamburguer"),t=document.querySelector(".menu-lateral"),o=document.querySelector(".menu-sobreposicao");if(!t||!o){console.error("Elementos do menu não encontrados");return}if(e.classList.toggle("ativo"),t.classList.toggle("ativo"),o.classList.toggle("ativo"),t.classList.contains("ativo")){const a=window.innerWidth-document.documentElement.clientWidth;a>0&&(document.body.style.paddingRight=a+"px"),document.body.classList.add("menu-aberto")}else setTimeout(()=>{document.body.style.paddingRight="",document.body.classList.remove("menu-aberto")},300)}function Pt(){const e=document.getElementById("painel-notificacoes");if(!e){console.error("[NAVBAR.JS] Painel de notificações não encontrado");return}e.style.display="block",e.style.visibility="visible",e.style.opacity="1",e.classList.add("ativo"),Ue(),typeof carregarNotificacoes=="function"&&carregarNotificacoes()}function L(){const e=document.getElementById("painel-notificacoes");e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0",e.classList.remove("ativo"))}function kt(){const e=document.querySelector(".menu-hamburguer"),t=document.querySelector(".menu-lateral"),o=document.querySelector(".menu-sobreposicao");if(t&&o){e.classList.add("ativo"),t.classList.add("ativo"),o.classList.add("ativo"),document.body.classList.add("menu-aberto");const a=document.querySelector(".painel-notificacoes");a&&a.classList.contains("ativo")&&L()}}function Ue(){const e=document.querySelector(".menu-hamburguer"),t=document.querySelector(".menu-lateral"),o=document.querySelector(".menu-sobreposicao");t&&o&&(e.classList.remove("ativo"),t.classList.remove("ativo"),o.classList.remove("ativo"),setTimeout(()=>{document.body.style.paddingRight="",document.body.classList.remove("menu-aberto")},300))}function Bt(){const e=document.getElementById("painel-notificacoes");if(!e){console.error("[NAVBAR.JS] Painel de notificações não encontrado");return}e.classList.contains("ativo")||e.style.display==="block"?L():Pt()}toastr.options={closeButton:!0,progressBar:!0,positionClass:"toast-bottom-right",showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};$(document).ready(function(){xt(),$(".cartao-motivo, .cartao-passo").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}),$("#formulario-newsletter").submit(function(e){e.preventDefault();const t=$(this).find('input[type="email"]').val();t&&t.indexOf("@")>0?($(this).find('input[type="email"]').val(""),le("Obrigado por se inscrever!","success")):le("Por favor, insira um email válido.","error")})});function le(e,t){if(typeof toastr<"u")switch(t){case"success":toastr.success(e);break;case"error":toastr.error(e);break;case"warning":toastr.warning(e);break;case"info":default:toastr.info(e);break}else alert(e)}function xt(){const e=function(){$(".cartao-motivo, .cartao-passo, .item-contador").each(function(){const t=$(this).offset().top,o=$(window).scrollTop(),a=$(window).height();o+a>t+100&&$(this).addClass("animated")})};e(),$(window).scroll(e)}document.addEventListener("DOMContentLoaded",function(){const e={menuToggle:document.querySelector(".usuario-menu-toggle"),dropdownMenu:document.getElementById("dropdownUsuario"),notificacoesIcone:document.querySelector(".icone-notificacao"),painelNotificacoes:document.getElementById("painel-notificacoes"),footer:document.querySelector(".footer"),navbar:document.querySelector(".navbar")};function t(){if(!e.dropdownMenu)return;e.dropdownMenu.style.display==="block"?a():o()}function o(){e.dropdownMenu&&(e.painelNotificacoes&&e.painelNotificacoes.classList.contains("ativo")&&fecharPainelNotificacoes(),e.dropdownMenu.style.display="block",e.dropdownMenu.classList.add("visivel"),document.body.classList.add("dropdown-aberto"),setTimeout(function(){document.addEventListener("click",n)},100))}function a(){e.dropdownMenu&&(e.dropdownMenu.classList.remove("visivel"),document.body.classList.remove("dropdown-aberto"),setTimeout(function(){e.dropdownMenu.style.display="none"},300))}e.menuToggle&&e.dropdownMenu&&(e.dropdownMenu.style.display="none",e.dropdownMenu.addEventListener("mouseover",function(m){const g=m.target.closest("a");g&&(g.style.backgroundColor="#505050")}),e.dropdownMenu.addEventListener("mouseout",function(m){const g=m.target.closest("a");g&&(g.style.backgroundColor="#3A3A3A")}),e.menuToggle.addEventListener("click",function(m){m.preventDefault(),m.stopPropagation(),t()}));function n(m){e.dropdownMenu&&!e.dropdownMenu.contains(m.target)&&(!e.menuToggle||!e.menuToggle.contains(m.target))&&(a(),document.removeEventListener("click",n))}const s=function(){document.body.classList.add("pagina-sobre");const m=document.createElement("button");m.innerHTML='<i class="fas fa-arrow-up"></i>',m.className="btn-voltar-topo",document.body.appendChild(m);const g=document.createElement("style");return g.innerHTML=`
            .btn-voltar-topo {
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                background-color: var(--primary-color);
                color: white;
                border: none;
                border-radius: 50%;
                cursor: pointer;
                font-size: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
                z-index: 999;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            }
            
            .btn-voltar-topo.mostrar {
                opacity: 1;
                visibility: visible;
            }
            
            .btn-voltar-topo:hover {
                background-color: var(--secondary-color);
                transform: translateY(-5px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            }
            
            /* Estilos corrigidos para o painel de notificações */
            #painel-notificacoes {
                position: absolute;
                z-index: 9999; 
                top: 45px; 
                right: 0; 
                width: 350px; 
                min-width: 350px; 
                max-width: 90vw; 
                background-color: white !important; 
                border-radius: 8px; 
                box-shadow: 0 8px 25px rgba(0,0,0,0.25);
                overflow: hidden;
                border: none;
                transition: all 0.3s ease;
            }
            
            .notificacoes-cabecalho {
                background-color: #FF6B00 !important;
                color: white;
                border-radius: 8px 8px 0 0;
                padding: 15px 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                width: 100%;
            }
            
            .carregando-notificacoes {
                padding: 30px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                background-color: white !important;
                width: 100%;
            }
            
            .lista-notificacoes {
                max-height: 400px;
                overflow-y: auto;
                background-color: white !important;
                width: 100%;
                scrollbar-width: thin;
                scrollbar-color: var(--primary-color) #f0f0f0;
            }
        `,document.head.appendChild(g),{btnTopo:m}}();let i=null;const r=function(m){return function(){i||(i=setTimeout(()=>{m(),i=null},50))}};let c=!0;const l=r(function(){if(e.painelNotificacoes?.classList.contains("ativo")||e.dropdownMenu&&e.dropdownMenu.style.display==="block"){c&&(c=!1),s.btnTopo&&(window.pageYOffset>300?s.btnTopo.classList.add("mostrar"):s.btnTopo.classList.remove("mostrar"));return}else c||(c=!0);e.navbar&&(window.scrollY>50?e.navbar.classList.add("scrolled"):e.navbar.classList.remove("scrolled")),s.btnTopo&&(window.pageYOffset>300?s.btnTopo.classList.add("mostrar"):s.btnTopo.classList.remove("mostrar"));const g=document.querySelector(".banner");if(g&&c){const p=window.pageYOffset;g.style.backgroundPositionY=`calc(50% + ${p*.4}px)`;const h=document.querySelector(".conteudo-banner");h&&p<500&&(h.style.opacity=Math.max(0,1-p*.002),h.style.transform=`translateY(${p*.2}px)`)}c&&d()});window.addEventListener("scroll",l),s.btnTopo.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})});function d(){const m=document.querySelectorAll(".contador-numero");let g=!1;if(!g&&m.length>0){const p=m[0].getBoundingClientRect(),h=window.innerHeight||document.documentElement.clientHeight;p.top<=h*.8&&p.bottom>=h*.2&&(m.forEach(re=>{u(re)}),g=!0)}}function u(m){const g=parseInt(m.getAttribute("data-contador"));let p=0;const h=g>100?5:1,yt=2e3/(g/h),ht=setInterval(()=>{p+=h,p>g?(m.textContent=g,clearInterval(ht)):m.textContent=p},yt)}if(e.notificacoesIcone&&e.painelNotificacoes){e.notificacoesIcone.addEventListener("click",function(p){p.preventDefault(),p.stopPropagation(),e.painelNotificacoes.classList.contains("ativo")?fecharPainelNotificacoes():requestAnimationFrame(()=>{B(),e.painelNotificacoes.classList.add("ativo"),e.painelNotificacoes.style.display="block",e.painelNotificacoes.style.visibility="visible",document.body.classList.add("painel-aberto"),carregarNotificacoes()})});const m=document.getElementById("fechar-notificacoes");m&&m.addEventListener("click",function(p){p.preventDefault(),fecharPainelNotificacoes()});const g=document.getElementById("marcar-todas-lidas");g&&g.addEventListener("click",function(p){p.preventDefault(),typeof window.marcarTodasComoLidas=="function"&&window.marcarTodasComoLidas()})}let f=null;document.addEventListener("click",function(m){clearTimeout(f),f=setTimeout(()=>{e.menuToggle&&e.dropdownMenu&&e.painelNotificacoes&&(e.menuToggle.contains(m.target)||e.dropdownMenu.contains(m.target)||e.notificacoesIcone&&e.notificacoesIcone.contains(m.target)||e.painelNotificacoes.contains(m.target)||B())},10)});const v=document.createElement("style");v.innerHTML=`
        /* CSS para otimizar performance quando painéis estão abertos */
        body.painel-aberto .banner {
            transition: none !important;
            animation: none !important;
        }
        
        body.painel-aberto .pata {
            animation-play-state: paused !important;
        }
        
        body.painel-aberto .scroll-btn {
            pointer-events: none;
        }
        
        body.painel-aberto .equipe-card {
            transform: none !important;
            transition: none !important;
        }
        
        /* Melhorar desempenho do painel de notificações */
        #painel-notificacoes {
            will-change: transform;
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        
        /* Melhorar desempenho do dropdown menu */
        #dropdownUsuario {
            will-change: transform;
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        
        /* Otimizar lista de notificações */
        .lista-notificacoes {
            will-change: transform;
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        
        /* Estilos para o avatar do usuário */
        .usuario-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #3A3A3A;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .usuario-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .avatar-inicial {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #FF6B00;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }
    `,document.head.appendChild(v);function B(){a(),fecharPainelNotificacoes(),document.body.classList.remove("painel-aberto")}function C(){const m=document.querySelectorAll(".equipe-card");document.querySelectorAll(".equipe-imagem");const g=document.querySelectorAll(".equipe-info");document.querySelectorAll(".equipe-imagem img").forEach(p=>{p.onerror=function(){console.error("Erro ao carregar imagem:",this.src),this.src="/imagens/paw-icon.png",this.style.objectFit="contain",this.style.padding="20px",this.style.backgroundColor="#f0f0f0",this.parentElement.classList.add("erro-carregamento")},p.onload=function(){this.style.opacity="1",this.parentElement.classList.add("fade-in")};const h=p.src;p.src="",p.src=h}),setTimeout(()=>{m.forEach((p,h)=>{setTimeout(()=>{p.classList.add("fade-active")},h*150)}),g.forEach((p,h)=>{setTimeout(()=>{p.classList.add("animate-fadeIn")},h*150+300)})},500)}C()});document.addEventListener("DOMContentLoaded",function(){if(_t(),typeof $>"u"){console.error("jQuery não está carregado!");return}if(typeof VMasker>"u"){console.error("Vanilla Masker não está carregado! Tentando carregar dinamicamente...");var e=document.createElement("script");e.src="/lib/vanilla-masker/vanilla-masker.js",e.onload=function(){de()},document.head.appendChild(e)}else de();At();const t=document.getElementById("formCadastro");t?t.addEventListener("submit",async function(o){o.preventDefault();const a=document.getElementById("Senha").value,n=document.getElementById("ConfirmarSenha").value;if(!a||a.length<6)return alert("A senha deve ter pelo menos 6 caracteres."),document.getElementById("Senha").focus(),!1;if(a!==n)return alert("As senhas não conferem."),document.getElementById("ConfirmarSenha").focus(),!1;if(document.getElementById("cpf").value.replace(/\D/g,"").length!==11)return alert("O CPF deve ter 11 dígitos."),document.getElementById("cpf").focus(),!1;const r=document.getElementById("email").value;if(!je(r))return alert("E-mail inválido."),document.getElementById("email").focus(),!1;try{if(await Ve(r))return alert("Este e-mail já está cadastrado. Por favor, use outro e-mail."),document.getElementById("email").focus(),!1}catch(l){console.error("Erro ao verificar email:",l)}document.getElementById("cpf").value,document.getElementById("telefone").value,document.getElementById("cep").value,zt();const c=document.getElementById("btnEnviar");c&&(c.disabled=!0,c.innerHTML='<i class="fas fa-spinner fa-spin"></i> Processando...'),setTimeout(function(){t.submit()},100)}):console.error("Formulário de cadastro não encontrado")});function de(){const e=document.getElementById("cpf");e&&VMasker(e).maskPattern("999.999.999-99");const t=document.getElementById("telefone");if(t){let n=function(s){const r=s.value.replace(/\D/g,"").length>10?"(99) 99999-9999":"(99) 9999-9999";VMasker(s).maskPattern(r)};var a=n;n(t),t.addEventListener("input",function(){n(this)})}const o=document.getElementById("cep");o&&VMasker(o).maskPattern("99999-999")}function At(){qt(),Ft();const e=document.getElementById("cep");e&&e.addEventListener("blur",function(){const a=this.value.replace(/\D/g,"");if(a.length!==0){if(a.length!==8){const n=document.getElementById("cep-feedback");n&&(n.textContent="CEP deve ter 8 dígitos",n.className="feedback-validacao invalido",n.style.display="block");return}Mt(a)}});const t=document.getElementById("cpf");t&&t.addEventListener("focus",function(){const a=document.getElementById("cpf-feedback");a&&(a.textContent="",a.className="feedback-validacao");const n=document.querySelector("span[data-valmsg-for='CPF']");n&&(n.textContent="",n.className="field-validation-valid",n.style.display="none")});const o=document.getElementById("cep");o&&o.addEventListener("focus",function(){const a=document.getElementById("cep-feedback");a&&(a.textContent="",a.className="feedback-validacao",a.style.display="none")}),fe(),window.addEventListener("resize",fe)}function qt(){const e=document.getElementById("cpf");e&&(e.addEventListener("blur",function(){Tt(this,this.value)}),e.addEventListener("input",function(){let a=this.value.replace(/\D/g,"");a.length>11&&(a=a.substring(0,11)),a.length<=11&&(a.length<=3?this.value=a:a.length<=6?this.value=a.substring(0,3)+"."+a.substring(3):a.length<=9?this.value=a.substring(0,3)+"."+a.substring(3,6)+"."+a.substring(6):this.value=a.substring(0,3)+"."+a.substring(3,6)+"."+a.substring(6,9)+"-"+a.substring(9)),this.value}));const t=document.getElementById("telefone");t&&(t.addEventListener("blur",function(){ue(this,this.value)}),t.addEventListener("input",function(){ue(this,this.value)}));const o=document.getElementById("cep");o&&o.addEventListener("input",function(){Nt(this,this.value)})}function Tt(e,t){const o=t.replace(/\D/g,"");if(o.length<3){e.value=o;return}let a=o.substring(0,3);o.length>3&&(a+="."+o.substring(3,6)),o.length>6&&(a+="."+o.substring(6,9)),o.length>9&&(a+="-"+o.substring(9,11)),e.value=a}function ue(e,t){let o=t.replace(/\D/g,"");o.length>11&&(o=o.substring(0,11));let a="";o.length<=2?a=o:o.length<=6?a="("+o.substring(0,2)+") "+o.substring(2):o.length<=10?a="("+o.substring(0,2)+") "+o.substring(2,6)+"-"+o.substring(6):a="("+o.substring(0,2)+") "+o.substring(2,7)+"-"+o.substring(7),e.value=a}function Nt(e,t){let o=t.replace(/\D/g,"");o.length>8&&(o=o.substring(0,8));let a="";if(o.length<=5?a=o:a=o.substring(0,5)+"-"+o.substring(5),e.value=a,o.length===8){const n=document.getElementById("cep-feedback");n&&(n.textContent="Validando CEP...",n.className="feedback-validacao",n.style.display="block")}}function Mt(e){const t=document.getElementById("cep-feedback");if(t&&(t.textContent="Buscando CEP...",t.className="feedback-validacao processando",t.style.display="block"),e.length!==8){console.error("CEP inválido:",e),t&&(t.textContent="CEP deve ter 8 dígitos",t.className="feedback-validacao invalido");return}fetch(`https://viacep.com.br/ws/${e}/json/`).then(o=>{if(!o.ok)throw new Error("Erro na requisição do CEP");return o.json()}).then(o=>{if(o.erro){console.error("CEP não encontrado"),t&&(t.textContent="CEP não encontrado",t.className="feedback-validacao invalido");return}o.logradouro&&(document.getElementById("logradouro").value=o.logradouro),o.bairro&&(document.getElementById("bairro").value=o.bairro),o.localidade&&(document.getElementById("cidade").value=o.localidade),o.uf&&(document.getElementById("estado").value=o.uf),document.getElementById("numero").focus(),t&&(t.textContent="CEP encontrado",t.className="feedback-validacao valido",setTimeout(()=>{t.style.display="none"},3e3))}).catch(o=>{console.error("Erro ao buscar CEP:",o),t&&(t.textContent="Erro ao buscar CEP",t.className="feedback-validacao invalido")})}function je(e){if(!e)return!1;const o=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),a=document.getElementById("email-feedback");return a&&(o||(a.textContent="E-mail inválido",a.className="feedback-validacao invalido")),o}const me=document.getElementById("email");if(me){let e;me.addEventListener("blur",function(){clearTimeout(e),e=setTimeout(async()=>{O(this.value)||Dt(this.value)&&await Ve(this.value)},300)})}function Dt(e){if(!e)return!1;const o=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),a=document.getElementById("email-feedback");return a&&(o||(a.textContent="E-mail inválido",a.className="feedback-validacao invalido")),o}async function Ve(e){const t=document.getElementById("email-feedback");t&&(t.textContent="Verificando e-mail...",t.className="feedback-validacao processando");try{const o=await fetch(`/usuario/verificar-email?email=${encodeURIComponent(e)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error("Erro ao verificar email");const a=await o.json();return t&&(a.emailExiste?(t.textContent="Este e-mail já está cadastrado",t.className="feedback-validacao invalido"):(t.textContent="",t.className="feedback-validacao")),a.emailExiste}catch(o){return console.error("Erro ao verificar se email existe:",o),t&&(t.textContent="Erro ao verificar e-mail",t.className="feedback-validacao invalido"),!1}}function O(e){return e==null||e.trim()===""}function Ft(){const e=document.getElementById("cpf");if(e){let n;e.addEventListener("blur",function(){clearTimeout(n),n=setTimeout(async()=>{O(this.value)||Rt(this.value)&&await Ot(this.value)},300)})}const t=document.getElementById("email");t&&t.addEventListener("blur",function(){O(this.value)||je(this.value)});const o=document.getElementById("Senha");o&&o.addEventListener("input",function(){const n=this.value,s={length:n.length>=8,upper:/[A-Z]/.test(n),lower:/[a-z]/.test(n),number:/[0-9]/.test(n),special:/[!@#$%^&*(),.?":{}|<>]/.test(n)};let i=0;Object.entries(s).forEach(([u,f])=>{const v=document.querySelector(`[data-requirement="${u}"] i`);v&&(v.className=f?"fas fa-check":"fas fa-times",f&&i++)});const r=n.length===0?0:i/5*100,c=document.querySelector(".strength-level");c&&(c.style.width=`${r}%`,r===0?c.style.background="var(--gray-light)":r<=20?c.style.background="var(--danger)":r<=40?c.style.background="var(--warning)":r<=60?c.style.background="var(--info)":r<=80?c.style.background="var(--secondary)":c.style.background="var(--success)");const l=document.querySelector(".strength-text strong");l&&(n.length===0?l.textContent="Digite uma senha":r<=20?l.textContent="Muito fraca":r<=40?l.textContent="Fraca":r<=60?l.textContent="Média":r<=80?l.textContent="Forte":l.textContent="Muito forte");const d=document.getElementById("senha-feedback");d&&(n.length===0?(d.textContent="",d.className="feedback-validacao"):i<5?(d.textContent="A senha não atende a todos os requisitos",d.className="feedback-validacao invalido"):(d.textContent="Senha válida",d.className="feedback-validacao valido"))});const a=document.getElementById("ConfirmarSenha");a&&a.addEventListener("input",function(){const n=document.getElementById("confirmarSenha-feedback");n&&o&&(this.value===o.value?(n.textContent="Senhas coincidem",n.className="feedback-validacao valido"):(n.textContent="Senhas não coincidem",n.className="feedback-validacao invalido"))})}function fe(){const e=window.innerWidth,t=document.querySelectorAll(".passo-texto");e<768?t.forEach(o=>{o.style.display="none"}):t.forEach(o=>{o.style.display="block"})}function zt(){const e=document.getElementById("cpf");if(e){const a=e.value,n=e.value.replace(/\D/g,"");n.length===11?e.value=n:console.warn(`CPF "${a}" / "${n}" não possui 11 dígitos`)}else console.warn("Campo CPF não encontrado para remover máscara");const t=document.getElementById("telefone");if(t){const a=t.value,n=t.value.replace(/\D/g,"");n.length>=10?t.value=n:console.warn(`Telefone "${a}" / "${n}" tem menos de 10 dígitos`)}else console.warn("Campo telefone não encontrado para remover máscara");const o=document.getElementById("cep");if(o){const a=o.value,n=o.value.replace(/\D/g,"");n.length===8?o.value=n:console.warn(`CEP "${a}" / "${n}" não possui 8 dígitos`)}else console.warn("Campo CEP não encontrado para remover máscara")}function Rt(e){if(!e)return!1;const o=e.replace(/\D/g,"").length===11,a=document.getElementById("cpf-feedback");return a&&(o||(a.textContent="CPF deve ter 11 dígitos",a.className="feedback-validacao invalido")),o}async function Ot(e){const t=document.getElementById("cpf-feedback");t&&(t.textContent="Verificando CPF...",t.className="feedback-validacao processando");try{const o=await fetch(`/usuario/verificar-cpf?cpf=${encodeURIComponent(e)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error("Erro ao verificar CPF");const a=await o.json();return t&&(a.cpfExiste?(t.textContent="Este CPF já está cadastrado",t.className="feedback-validacao invalido"):(t.textContent="",t.className="feedback-validacao")),a.cpfExiste}catch(o){return console.error("Erro ao verificar se CPF existe:",o),t&&(t.textContent="Erro ao verificar CPF",t.className="feedback-validacao invalido"),!1}}const pe=document.getElementById("telefone");if(pe){let e;pe.addEventListener("blur",function(){clearTimeout(e),e=setTimeout(()=>{O(this.value)||Ht(this.value)},300)})}function Ht(e){if(!e)return!1;const o=e.replace(/\D/g,"").length>=10,a=document.getElementById("telefone-feedback");return a&&(o?(a.textContent="",a.className="feedback-validacao"):(a.textContent="Telefone inválido",a.className="feedback-validacao invalido")),o}function _t(){window.addEventListener("scroll",function(){const e=document.querySelector(".navbar");window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")})}window.addEventListener("scroll",function(){const e=document.querySelector(".navbar");window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")});function Ut(e){const t=document.getElementById(e),a=document.querySelector(".botao-senha").querySelector("i");t.type==="password"?(t.type="text",a.classList.replace("fa-eye","fa-eye-slash")):(t.type="password",a.classList.replace("fa-eye-slash","fa-eye"))}document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".botao-senha");e&&e.addEventListener("click",function(){Ut("Senha")});const t=document.querySelectorAll(".alerta");t.length>0&&setTimeout(function(){t.forEach(o=>{o.style.opacity="0",setTimeout(()=>{o.style.display="none"},500)})},5e3)});function jt(e){document.querySelectorAll(".cartao-opcao").forEach(n=>{n.classList.remove("selecionado")});const t=document.getElementById("card-"+e);t&&t.classList.add("selecionado");const o=document.getElementById("tipoPerfil");o&&(o.value=e);const a=document.getElementById("btnContinuar");a&&(a.disabled=!1)}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("formPerfil");e&&e.addEventListener("submit",function(o){document.getElementById("tipoPerfil").value||(o.preventDefault(),alert("Por favor, selecione um perfil para continuar."))});const t=document.querySelectorAll(".cartao-opcao");if(t.length===1){const o=t[0].id.replace("card-","");jt(o)}});const J={api:{baseUrl:"/usuario/adocao",headers:{"Content-Type":"application/json"}}},N={requestToken:null,userId:null,userCpf:null,filtroAtivo:"all",adocaoIdAtual:null};document.addEventListener("DOMContentLoaded",function(){Vt()});function Vt(){Wt(),Yt(),Gt(),Jt(),We()}function Wt(){toastr.options=J.toastr}function Yt(){N.requestToken=document.getElementById("requestVerificationToken")?.value,N.userId=document.getElementById("userId")?.value,N.userCpf=document.getElementById("userCpf")?.value,Xt()}function Gt(){Zt(),to(),oo()}function Jt(){Qt(),inicializarBotaoCancelamento()}function Xt(){const e=document.getElementById("temp-data");if(!e)return;const{success:t,error:o}=e.dataset;t&&toastr.success(t),o&&toastr.error(o)}function Zt(e=document){if(typeof bootstrap>"u")return;e.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(o=>{o._tooltip||new bootstrap.Tooltip(o,{container:"body",html:!1,trigger:"hover focus"})})}function Qt(){const e=document.getElementById("filtroStatus"),t=document.getElementById("pesquisaNomePet"),o=document.querySelectorAll(".card-estatistica");e&&e.addEventListener("change",W),t&&t.addEventListener("input",W),o.forEach(a=>{a.addEventListener("click",()=>{o.forEach(n=>n.classList.remove("active")),a.classList.add("active"),e&&(e.value=a.dataset.status),W()})}),o.length>0&&!document.querySelector(".card-estatistica.active")&&o[0].classList.add("active")}function W(){const e=document.querySelector(".card-estatistica.active")?.dataset?.status||"all",t=document.getElementById("pesquisaNomePet")?.value.trim().toLowerCase()||"",o=document.querySelectorAll(".adocao-item");let a=0;o.forEach(n=>{const s=n.dataset.status,i=n.dataset.nome,r=e==="all"||s===e,c=!t||i.includes(t),l=r&&c;n.style.display=l?"block":"none",l&&a++}),eo(e),Kt(a),setTimeout(()=>{We()},100)}function Kt(e){const t=document.querySelector(".estado-vazio");t&&(t.style.display=e===0?"flex":"none")}function eo(e){document.querySelectorAll(".card-estatistica").forEach(o=>{o.dataset.status===e?o.classList.add("active"):o.classList.remove("active")})}function to(){document.querySelectorAll(".adocao-item").forEach((t,o)=>{t.style.opacity="0",t.style.transform="translateY(20px)",setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)"},o*100)})}function oo(){ao()}function ao(){const e=document.getElementById("modalCancelamento");if(!e)return;const t=e.querySelector("form");t&&t.addEventListener("submit",no)}function no(e){e.preventDefault();const t=document.getElementById("motivoCancelamento").value.trim(),o=document.getElementById("adocaoIdCancelar").value;so(t)&&ro(o,t)}function so(e){const t=document.getElementById("erroMotivo"),o=document.getElementById("motivoCancelamento");return e?e.length<10?(ge(t,o,"O motivo do cancelamento deve ter pelo menos 10 caracteres."),!1):(io(t,o),!0):(ge(t,o,"O motivo do cancelamento é obrigatório."),!1)}function ge(e,t,o){e.textContent=o,e.style.display="block",t.classList.add("is-invalid"),t.focus()}function io(e,t){e.style.display="none",t.classList.remove("is-invalid")}async function ro(e,t){const o=document.getElementById("btnConfirmarCancelamento");if(o)try{o.disabled=!0,o.innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Processando...';const a=await fetch(`${J.api.baseUrl}/cancelar-formulario-adocao/${e}`,{method:"POST",headers:{...J.api.headers,RequestVerificationToken:N.requestToken},body:JSON.stringify({MotivoCancelamento:t})});if(!a.ok){const s=await a.json();throw new Error(s.message||"Erro ao cancelar a adoção")}const n=await a.json();co(n)}catch(a){lo(a,o)}}function co(e){const t=bootstrap.Modal.getInstance(document.getElementById("modalCancelamento"));t&&t.hide(),toastr.success(e.message||"Adoção cancelada com sucesso!"),setTimeout(()=>window.location.reload(),1500)}function lo(e,t){console.error("Erro:",e),toastr.error(e.message||"Erro ao cancelar a adoção. Por favor, tente novamente mais tarde."),t&&(t.disabled=!1,t.innerHTML='<i class="fas fa-check me-2"></i>Sim, Cancelar Adoção')}function We(){document.querySelectorAll(".badge-status, .badge-status-detalhes").forEach(t=>{const o=Array.from(t.classList).filter(a=>a!=="badge-status"&&a!=="badge-status-detalhes");if(o.length>0){const a=o[0];let n="";switch(a){case"pendente":n="fa-clock";break;case"aprovada":case"aprovado":n="fa-check-circle";break;case"aguardando-buscar":n="fa-hourglass-half";break;case"finalizada":n="fa-heart";break;case"cancelada":n="fa-ban";break;case"rejeitada":n="fa-times-circle";break;case"em-processo":n="fa-sync";break;default:n="fa-info-circle"}if(!t.querySelector("i")){const s=t.textContent.trim();t.innerHTML="";const i=document.createElement("i");i.className=`fas ${n}`,i.style.marginRight="0.5rem",t.appendChild(i),t.appendChild(document.createTextNode(s))}}})}$(document).ready(function(){$("#selectItensPorPagina").change(function(){var e=$(this).val();window.location.href="/usuario/adocoes?pagina=1&itensPorPagina="+e}),$(document).on("click",".pagination .page-link",function(e){e.preventDefault();var t=$(this).attr("href");return t&&(window.location.href=t),!1})});toastr.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!0,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};let I=0,Y=null,ve=!1;function ye(){console.log("Página carregada, inicializando componentes..."),So(),$o(),wo(),inicializarPaginacao();function e(){console.log("Verificando carregamento dos cards...");const r=document.querySelectorAll(".pet-card"),c=document.querySelector(".pets-grid");if(r.length===0&&c){console.log("Nenhum card encontrado, tentando recarregar...");const l=document.getElementById("formFiltros");if(l)try{l.submit()}catch(d){console.error("Erro ao enviar formulário:",d),window.location.reload()}else window.location.href="/usuario/pets/explorar"}else console.log(`${r.length} cards encontrados, ajustando visibilidade...`),r.forEach(l=>{l.style.display="block",l.style.opacity="1",l.style.visibility="visible"}),c&&(c.style.display="grid")}const t=document.referrer;t&&(t.includes("/usuario/adocao/formulario/")||t.includes("/adocao/formulario/"))&&setTimeout(e,500),window.temMensagensTempData&&(window.mensagemErro&&Ee("erro",window.mensagemErro),window.mensagemSucesso&&Ee("sucesso",window.mensagemSucesso));const o=document.getElementById("dados-usuario");o&&(ve=o.dataset.usuarioLogado==="true",o.dataset.usuarioId,o.dataset.usuarioNome,o.dataset.usuarioTipo);const a=document.getElementById("carouselPets");if(a)try{if(typeof bootstrap<"u"&&bootstrap.Carousel){var n=new bootstrap.Carousel(a,{interval:5e3,pause:!1,wrap:!0});Le(),a.addEventListener("slid.bs.carousel",function(){Le()})}else be(),a.querySelectorAll(".carousel-item").forEach((c,l)=>{c.style.display=l===0?"block":"none"}),Ge(0)}catch(r){console.error("Erro ao inicializar carrossel:",r),be()}document.addEventListener("click",vo),document.addEventListener("keydown",yo),ho(),fo(),uo(),mo(),bo(),Co(),Ce(),window.addEventListener("resize",Ce),document.querySelectorAll(".botao-adotar, .adopt-button").forEach(r=>{r.addEventListener("click",function(c){if(!ve){c.preventDefault();const l=this.closest(".cartao-pet, .pet-card");if(l){const d=l.dataset.id||"";po("modalLoginCadastro"),document.getElementById("petIdAutenticacao").value=d}}})});var s=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));s.map(function(r){return new bootstrap.Tooltip(r)});const i=document.getElementById("selectItensPorPagina");i&&(i.removeEventListener("change",he),i.addEventListener("change",he)),console.log("Evento de mudança do seletor de itens por página registrado")}document.readyState!=="loading"?ye():document.addEventListener("DOMContentLoaded",ye);function he(){const e=parseInt(this.value,10);if(isNaN(e)){console.error("Valor inválido no seletor de itens por página:",this.value);return}console.log("Valor selecionado para itens por página:",e),document.getElementById("itensPorPagina").value=e,document.getElementById("itensPorPaginaNav").value=e,document.getElementById("paginaAtual").value=1,document.getElementById("formNavegacao").submit()}function uo(){const e=document.getElementById("btnMenuHamburguer");if(e){const a=e.cloneNode(!0);e.parentNode.replaceChild(a,e),a.addEventListener("click",function(n){if(n.preventDefault(),typeof window.alternarMenu=="function")window.alternarMenu();else{const s=document.querySelector(".menu-lateral"),i=document.querySelector(".menu-sobreposicao");s&&i&&(s.classList.contains("ativo")?(s.classList.remove("ativo"),i.classList.remove("ativo"),this.classList.remove("ativo")):(s.classList.add("ativo"),i.classList.add("ativo"),this.classList.add("ativo")))}})}const t=document.querySelector(".menu-sobreposicao");t&&t.addEventListener("click",function(){if(typeof window.fecharMenuLateral=="function")window.fecharMenuLateral();else{const a=document.querySelector(".menu-lateral"),n=document.getElementById("btnMenuHamburguer");a&&a.classList.remove("ativo"),n&&n.classList.remove("ativo"),this.classList.remove("ativo")}});const o=document.getElementById("notificacaoIcone");if(o){const a=o.cloneNode(!0);o.parentNode.replaceChild(a,o),a.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation(),typeof window.togglePainelNotificacoes=="function"&&window.togglePainelNotificacoes()})}}function mo(){const e=document.querySelector("#btnLimparFiltros, .botao-limpar, .clear-button");e&&e.addEventListener("click",function(t){t.preventDefault(),Ye()}),document.getElementById("filtroNome")?.addEventListener("keypress",function(t){t.key==="Enter"&&(t.preventDefault(),document.getElementById("formFiltros")?.submit())})}function fo(){const e=document.getElementById("formFiltros");if(!e){console.error("Formulário de filtros não encontrado");return}document.querySelector(".botao-filtrar")?.addEventListener("click",function(a){a.preventDefault(),e.submit()});const t=document.querySelectorAll(".cartao-pet"),o=document.querySelector(".mensagem-sem-pets");t.length===0&&o?o.style.display="flex":o&&(o.style.display="none")}function po(e){const t=document.getElementById(e);t&&(t.style.display="flex",document.body.classList.add("modal-aberto"))}function go(e){const t=document.getElementById(e);t&&(t.style.display="none",document.body.classList.remove("modal-aberto"))}function vo(e){const t=document.getElementById("painel-notificacoes");if(t&&t.classList.contains("ativo")){const o=document.querySelector(".icone-notificacao");o&&!o.contains(e.target)&&!t.contains(e.target)&&t.classList.remove("ativo")}}function yo(e){e.key==="Escape"&&document.querySelectorAll(".modal").forEach(o=>{if(o.style.display==="flex"){const a=o.id;go(a)}})}function ho(){const e=new URLSearchParams(window.location.search),t=e.get("mensagem"),o=e.get("tipo")||"info";if(t){Eo(t,o);const a=new URL(window.location.href);a.searchParams.delete("mensagem"),a.searchParams.delete("tipo"),window.history.replaceState({},document.title,a.toString())}}function Eo(e,t){typeof toastr<"u"?t==="success"?toastr.success(e):t==="error"?toastr.error(e):toastr.info(e):alert(e)}function Ye(){const e=document.getElementById("formFiltros");e&&e.reset(),window.location.href="/usuario/pets/explorar"}function Ee(e,t){if(!t)return;const n=`
        <div class="alert ${e==="erro"?"alert-danger":"alert-success"} alert-dismissible fade show d-flex align-items-center" role="alert">
            <div class="me-3 fs-4">${e==="erro"?'<i class="fas fa-exclamation-circle"></i>':'<i class="fas fa-check-circle"></i>'}</div>
            <div>${t}</div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
        </div>
    `,s=document.getElementById("alertaContainer");s&&(s.innerHTML=n,setTimeout(()=>{document.querySelectorAll(".alert").forEach(r=>{typeof bootstrap<"u"?new bootstrap.Alert(r).close():r.remove()})},5e3))}function bo(){const e=document.querySelectorAll(".pet-card");e.forEach((o,a)=>{o.style.setProperty("--animal-index",a%12),o.querySelectorAll(".pet-item").forEach(i=>{const r=i.querySelector("i");r&&(r.classList.contains("fa-mars")||r.classList.contains("fa-venus")?(r.style.transition="all 0.3s ease",i.addEventListener("mouseenter",function(){r.style.transform="scale(1.2) rotate(15deg)"}),i.addEventListener("mouseleave",function(){r.style.transform=""})):r.classList.contains("fa-ruler")?(r.style.transition="all 0.3s ease",i.addEventListener("mouseenter",function(){r.style.transform="scale(1.2) translateY(-2px)"}),i.addEventListener("mouseleave",function(){r.style.transform=""})):r.classList.contains("fa-calendar-alt")?(r.style.transition="all 0.3s ease",i.addEventListener("mouseenter",function(){r.style.transform="scale(1.2) rotate(-10deg)"}),i.addEventListener("mouseleave",function(){r.style.transform=""})):r.classList.contains("fa-paw")&&(r.style.transition="all 0.3s ease",i.addEventListener("mouseenter",function(){r.style.transform="scale(1.2) rotate(10deg)"}),i.addEventListener("mouseleave",function(){r.style.transform=""}))),i.addEventListener("mouseenter",function(){this.style.transform="translateY(-5px)",this.style.boxShadow="0 8px 15px rgba(0, 0, 0, 0.1)"}),i.addEventListener("mouseleave",function(){this.style.transform="",this.style.boxShadow=""})});const s=o.querySelector(".pet-description");s&&(s.addEventListener("mouseenter",function(){this.style.borderTopColor="#ccc",this.style.borderBottomColor="#ccc",this.style.transition="all 0.3s ease";const i=this.querySelector(".description-icon");i&&(i.style.transform="scale(1.2)",i.style.transition="transform 0.3s ease")}),s.addEventListener("mouseleave",function(){this.style.borderTopColor="",this.style.borderBottomColor="";const i=this.querySelector(".description-icon");i&&(i.style.transform="")}))});const t=new IntersectionObserver(o=>{o.forEach(a=>{a.isIntersecting&&(a.target.classList.add("visible"),t.unobserve(a.target))})},{threshold:.1,rootMargin:"0px 0px -100px 0px"});e.forEach(o=>{t.observe(o)})}function be(){Y&&clearInterval(Y),Y=setInterval(function(){Io()},5e3)}function Ge(e){const t=document.querySelectorAll(".carousel-item");t.length!==0&&e!==I&&(t[I].classList.remove("active"),I=e,I<0?I=t.length-1:I>=t.length&&(I=0),t[I].classList.add("active"))}function Io(){Ge(I+1)}function Lo(){const e=document.getElementById("formFiltros"),t=document.getElementById("formNavegacao");!e||!t||(document.getElementById("filtroNome")&&document.getElementById("filtroNomeNav")&&(document.getElementById("filtroNomeNav").value=document.getElementById("filtroNome").value),document.getElementById("filtroEspecie")&&document.getElementById("filtroEspecieNav")&&(document.getElementById("filtroEspecieNav").value=document.getElementById("filtroEspecie").value),document.getElementById("filtroSexo")&&document.getElementById("filtroSexoNav")&&(document.getElementById("filtroSexoNav").value=document.getElementById("filtroSexo").value),document.getElementById("filtroPorte")&&document.getElementById("filtroPorteNav")&&(document.getElementById("filtroPorteNav").value=document.getElementById("filtroPorte").value),document.getElementById("filtroOrdem")&&document.getElementById("filtroOrdemNav")&&(document.getElementById("filtroOrdemNav").value=document.getElementById("filtroOrdem").value),document.getElementById("filtroIdade")&&document.getElementById("filtroIdadeNav")&&(document.getElementById("filtroIdadeNav").value=document.getElementById("filtroIdade").value))}function Co(){const e=document.querySelectorAll(".pet-card");if(e.length===0){const i=document.querySelector(".no-pets-message");i&&(i.style.display="flex",i.innerHTML=`
                <div class="text-center w-100">
                    <i class="fas fa-search fa-4x mb-3 text-muted"></i>
                    <h3>Nenhum pet encontrado</h3>
                    <p>Tente modificar os filtros ou voltar mais tarde.</p>
                    <a href="/usuario/pets/explorar" class="btn btn-primary mt-3">
                        <i class="fas fa-sync-alt me-2"></i> Limpar filtros
                    </a>
                </div>
            `);return}let t=X();const o=document.getElementById("paginaAtual");let a=1;if(o&&(a=parseInt(o.value)||1),a>1&&e.length<t){ne(a-1);return}e.length;const n=document.getElementById("selectItensPorPagina");n&&parseInt(n.value),Ie(),window.addEventListener("resize",function(){const i=X();i!==t&&(t=i,Ie())});const s=document.querySelector("#btnLimparFiltros, .botao-limpar, .clear-button");s&&s.addEventListener("click",function(i){i.preventDefault(),Ye()})}function X(){const e=document.querySelector(".pets-grid");if(!e||!e.children||e.children.length===0)return window.innerWidth<=992?2:window.innerWidth<=1366?3:window.innerWidth<=1920?4:window.innerWidth<=2560?5:6;try{const t=e.children[0];if(!t)return 4;const a=t.getBoundingClientRect().top;let n=0;const s=5;for(let i=0;i<Math.min(e.children.length,12);i++){const r=e.children[i].getBoundingClientRect();if(Math.abs(r.top-a)<=s)n++;else break}if(n<=0||n>8){const r=window.getComputedStyle(e).getPropertyValue("grid-template-columns");if(r.includes("repeat")){const c=r.match(/repeat\((\d+)/);if(c&&c[1])return parseInt(c[1])}return window.innerWidth<=992?2:window.innerWidth<=1366?3:window.innerWidth<=1920?4:window.innerWidth<=2560?5:6}return n}catch(t){return console.error("Erro ao calcular colunas do grid:",t),window.innerWidth<=992?2:window.innerWidth<=1366?3:window.innerWidth<=1920?4:window.innerWidth<=2560?5:6}}function Ie(){const e=document.querySelectorAll(".pet-card");if(e.length===0)return;const t=document.getElementById("selectItensPorPagina"),o=t&&parseInt(t.value)||12,a=o,n=document.getElementById("paginaAtual"),s=n&&parseInt(n.value)||1;document.getElementById("itensPorPagina")&&(document.getElementById("itensPorPagina").value=o),document.getElementById("itensPorPaginaNav")&&(document.getElementById("itensPorPaginaNav").value=o),e.forEach((r,c)=>{c<a?(r.style.display="block",r.style.opacity="1",r.style.visibility="visible"):r.style.display="none"});const i=Math.min(a,e.length);return Je(i),n&&s>1&&e.length===0&&ne(s-1),i}function Je(e){const t=document.querySelectorAll(".pet-card").length,o=document.querySelector(".contador-texto");if(o){const a=document.getElementById("selectItensPorPagina"),n=a&&parseInt(a.value)||12,s=Math.min(e,t,n);o.innerHTML=`
            <span>Exibindo</span>
            <strong>${s}</strong>
            <span>de</span>
            <strong>${t}</strong>
            <span>pets</span>
        `}}function ne(e){console.log("Função navegarParaPagina chamada com página: "+e),document.getElementById("paginaAtual").value=e,Lo();const t=document.getElementById("selectItensPorPagina"),o=t&&parseInt(t.value)||12;document.getElementById("itensPorPaginaNav").value=o,Xe();const a=document.getElementById("formNavegacao");a.querySelectorAll('input[name="navegacaoPagina"]').forEach(i=>i.remove());let s=document.createElement("input");s.type="hidden",s.name="navegacaoPagina",s.value="true",a.appendChild(s),console.log("Submetendo formulário de navegação para página: "+e),a.submit()}function Xe(){const e=document.querySelector(".pets-grid");if(e){const t=document.createElement("div");t.className="loading-overlay",t.innerHTML='<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Carregando...</span></div>',t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.background="rgba(255,255,255,0.8)",t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="10";const o=e.parentElement;o&&(o.style.position="relative",o.appendChild(t))}}function wo(){console.log("Configurando funcionamento da paginação..."),$(".paginacao").css("display","block"),$(".pagination").css("display","flex"),$(".paginacao-info").css("display","flex"),$(".itens-por-pagina").css("display","flex"),$(".paginacao").attr("style","display: block !important"),$(".pagination").attr("style","display: flex !important"),$(".paginacao-info").attr("style","display: flex !important"),$(".itens-por-pagina").attr("style","display: flex !important"),$(".pagination .page-link").off("click"),$(".pagination .page-link").on("click",function(t){t.preventDefault(),t.stopPropagation();const o=$(this).attr("data-pagina");return console.log("Link de paginação clicado. Página:",o),o&&ne(o),!1});const e=document.getElementById("selectItensPorPagina");e&&($(e).off("change"),$(e).on("change",function(){const t=parseInt(this.value,10);if(!isNaN(t)){console.log("Alterando itens por página para:",t),document.getElementById("itensPorPagina").value=t,document.getElementById("itensPorPaginaNav").value=t,document.getElementById("paginaAtual").value=1,$('#formNavegacao input[name="navegacaoPagina"]').remove();let o=document.createElement("input");o.type="hidden",o.name="navegacaoPagina",o.value="false",document.getElementById("formNavegacao").appendChild(o),Xe(),document.getElementById("formNavegacao").submit()}})),$(".pagination .page-link").each(function(){if(!$(this).attr("data-pagina")){const o=new URL(this.href,window.location.origin).searchParams.get("pagina");o&&$(this).attr("data-pagina",o)}})}function Le(){document.querySelectorAll(".carousel-progress-bar").forEach(function(e){e.style.transition="none",e.style.width="0%"}),setTimeout(function(){const e=document.querySelector(".carousel-item.active");if(e){const t=e.querySelector(".carousel-progress-bar");t&&(t.offsetWidth,t.style.transition="width 5s linear",t.style.width="100%")}},50)}function So(){const e=document.getElementById("selectItensPorPagina");let t=12;if(e){const o=parseInt(e.value,10);t=isNaN(o)?12:o,console.log("Valor selecionado pelo usuário:",t),e.value=t}return console.log("Inicializando itens por página:",t),document.getElementById("itensPorPagina")&&(document.getElementById("itensPorPagina").value=t),document.getElementById("itensPorPaginaNav")&&(document.getElementById("itensPorPaginaNav").value=t),t}$(document).ready(function(){});function Ce(){const e=document.querySelectorAll(".pet-card"),t=document.querySelector(".pets-grid");if(!t||e.length===0)return;const o=t.clientWidth;console.log(`Largura do grid: ${o}px`);const a=X();console.log(`Cards por linha: ${a}`);const n=parseInt(window.getComputedStyle(t).gap)||32,s=Math.floor((o-n*(a-1))/a);console.log(`Largura ideal calculada para cada card: ${s}px`);const r=Math.min(s,420);console.log(`Largura final dos cards: ${r}px`),e.forEach(c=>{c.style.maxWidth=`${r}px`,c.style.width="100%"})}function $o(){const e=document.getElementById("selectItensPorPagina"),t=e&&parseInt(e.value,10)||12,o=document.querySelectorAll(".pet-card");o.forEach((n,s)=>{s<t?(n.style.display="block",n.style.opacity="1",n.style.visibility="visible"):(n.style.display="none",n.style.opacity="0",n.style.visibility="hidden")});const a=Math.min(t,o.length);Je(a),console.log(`Limitando exibição para ${t} itens por página. Exibindo ${a} de ${o.length} cards.`)}document.addEventListener("DOMContentLoaded",()=>{Bo(),xo(),Ao(),qo(),To(),No(),Mo(),Do(),Fo(),zo(),Ro(),Oo(),Ho(),_o(),Vo(),Uo()});function Po(e){document.getElementById(e)?.classList.add("is-open"),document.body.style.overflow="hidden"}function ko(e){document.getElementById(e)?.classList.remove("is-open"),document.body.style.overflow=""}function Bo(){document.addEventListener("keydown",e=>{e.key==="Escape"&&document.querySelectorAll(".modal.is-open").forEach(t=>{t.classList.remove("is-open"),document.body.style.overflow=""})})}function xo(){document.querySelectorAll(".tabs__button").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tab;document.querySelectorAll(".tabs__button").forEach(o=>o.classList.remove("tabs__button--active")),document.querySelectorAll(".tabs__panel").forEach(o=>o.classList.remove("tabs__panel--active")),e.classList.add("tabs__button--active"),document.getElementById(t)?.classList.add("tabs__panel--active")})})}function Ao(){const e=document.getElementById("scrollTop");e&&(window.addEventListener("scroll",()=>{window.scrollY>300?e.classList.add("ativo"):e.classList.remove("ativo")}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function qo(){const e=document.getElementById("uploadFoto");e&&e.addEventListener("change",Wo)}function To(){const e=document.getElementById("cpf");e&&IMask(e,{mask:"000.000.000-00",lazy:!1});const t=document.getElementById("telefone");t&&IMask(t,{mask:"(00) 00000-0000",lazy:!1});const o=document.getElementById("cep");o&&IMask(o,{mask:"00000-000",lazy:!1})}function No(){const e=document.getElementById("cep"),t=document.getElementById("btnBuscarCep");if(!e)return;const o=()=>{const a=e.value.replace(/\D/g,"");if(a.length!==8){y("Digite um CEP válido com 8 dígitos","error");return}t&&(t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Buscando...',t.disabled=!0),fetch(`https://viacep.com.br/ws/${a}/json/`).then(n=>n.json()).then(n=>{if(n.erro)y("CEP não encontrado","error");else{const s={logradouro:n.logradouro,bairro:n.bairro,cidade:n.localidade,estado:n.uf};Object.keys(s).forEach(i=>{const r=document.getElementById(i);r&&s[i]&&(r.value=s[i])}),document.getElementById("numero")?.focus(),y("Endereço encontrado com sucesso!","success")}}).catch(n=>{console.error("Error fetching address:",n),y("Erro ao buscar o CEP","error")}).finally(()=>{t&&(t.innerHTML='<i class="fas fa-search"></i> Buscar CEP',t.disabled=!1)})};t&&t.addEventListener("click",o),e.addEventListener("blur",function(){this.value.replace(/\D/g,"").length===8&&o()})}function y(e,t="info"){const o=document.getElementById("notification"),a=document.getElementById("notification-text");if(!o||!a)return;a.textContent=e,o.className="notification",o.classList.add(`notification--${t}`,"visivel");const n=setTimeout(()=>{o.classList.remove("visivel")},5e3);o.querySelector(".notification__close")?.addEventListener("click",()=>{clearTimeout(n),o.classList.remove("visivel")})}function Mo(){const e=document.getElementById("flashMessage"),t=document.getElementById("flashType");e&&e.value&&y(e.value,t?.value||"info")}function Do(){document.querySelectorAll(".toggle-password").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.toggle,o=document.getElementById(t);if(!o)return;const a=o.type==="password"?"text":"password";o.type=a;const n=e.querySelector("i");n&&(n.className=a==="text"?"fas fa-eye-slash":"fas fa-eye")})})}function Fo(){const e=document.getElementById("novaSenha");e&&e.addEventListener("input",()=>{const t=e.value,o={length:t.length>=8,upper:/[A-Z]/.test(t),lower:/[a-z]/.test(t),number:/[0-9]/.test(t),special:/[!@#$%^&*(),.?":{}|<>]/.test(t)};let a=0;Object.entries(o).forEach(([r,c])=>{const l=document.querySelector(`[data-requirement="${r}"] i`);l&&(l.className=c?"fas fa-check":"fas fa-times",c&&a++)});const n=t.length===0?0:a/5*100,s=document.querySelector(".strength-level");s&&(s.style.width=`${n}%`,n===0?s.style.background="var(--gray-light)":n<=20?s.style.background="var(--danger)":n<=40?s.style.background="var(--warning)":n<=60?s.style.background="var(--info)":n<=80?s.style.background="var(--secondary)":s.style.background="var(--success)");const i=document.querySelector(".strength-text strong");i&&(t.length===0?i.textContent="Digite uma senha":n<=20?i.textContent="Muito fraca":n<=40?i.textContent="Fraca":n<=60?i.textContent="Média":n<=80?i.textContent="Forte":i.textContent="Muito forte")})}function zo(){const e=document.getElementById("novaSenha"),t=document.getElementById("confirmarSenha"),o=document.querySelector(".password-match");if(!e||!t||!o)return;function a(){const n=e.value,s=t.value;if(s===""){o.innerHTML="";return}const i=n===s;o.innerHTML=i?'<i class="fas fa-check" style="color:var(--success)"></i> Senhas coincidem':'<i class="fas fa-times" style="color:var(--danger)"></i> Senhas não coincidem'}t.addEventListener("input",a),e.addEventListener("input",a)}function Ro(){const e=document.getElementById("formEditarPerfil");e&&e.addEventListener("submit",t=>{t.preventDefault();const o=e.querySelectorAll("[required]");let a=!1;if(o.forEach(n=>{n.value.trim()?n.classList.remove("error"):(n.classList.add("error"),a=!0)}),a){y("Preencha todos os campos obrigatórios","error");return}e.submit()})}function Oo(){const e=document.getElementById("formAlterarSenha");e&&e.addEventListener("submit",t=>{t.preventDefault();const o=document.getElementById("senhaAtual").value,a=document.getElementById("novaSenha").value,n=document.getElementById("confirmarSenha").value;if(!o){y("Digite sua senha atual","error");return}if(!a){y("Digite a nova senha","error");return}if(!([a.length>=8,/[A-Z]/.test(a),/[a-z]/.test(a),/[0-9]/.test(a),/[!@#$%^&*(),.?":{}|<>]/.test(a)].filter(Boolean).length>=3)){y("A senha não atende aos requisitos mínimos de segurança","error");return}if(a!==n){y("As senhas não coincidem","error");return}e.submit()})}function Ho(){document.querySelectorAll(".perfil__item").forEach(t=>{t.addEventListener("mouseenter",()=>{const o=t.querySelector(".perfil__item-icon i");o&&o.classList.add("fa-bounce")}),t.addEventListener("mouseleave",()=>{const o=t.querySelector(".perfil__item-icon i");o&&o.classList.remove("fa-bounce")})})}function _o(){const e=document.querySelectorAll(".contact-card");e.forEach((t,o)=>{setTimeout(()=>{t.style.opacity="0",t.style.transform="translateY(20px)",setTimeout(()=>{t.style.transition="all 0.5s ease",t.style.opacity="1",t.style.transform="translateY(0)"},100)},o*150)}),e.forEach(t=>{t.addEventListener("mouseenter",()=>{const o=t.querySelector(".contact-card__icon i");o&&o.classList.add("fa-bounce")}),t.addEventListener("mouseleave",()=>{const o=t.querySelector(".contact-card__icon i");o&&o.classList.remove("fa-bounce")})})}function Uo(){const e=document.getElementById("btnRemoverFoto"),t=document.getElementById("modalConfirmarRemoverFoto"),o=document.getElementById("btnConfirmarRemoverFoto");e&&t&&e.addEventListener("click",a=>{a.preventDefault(),Po("modalConfirmarRemoverFoto")}),o&&o.addEventListener("click",a=>{a.preventDefault(),jo()})}function jo(){const e=document.querySelector(".perfil__avatar-remove");if(!e)return;const t=e.innerHTML;e.innerHTML='<i class="fas fa-spinner fa-spin"></i>',e.style.pointerEvents="none";const o=document.querySelector('input[name="__RequestVerificationToken"]').value;fetch("/usuario/perfil/remover-foto",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`__RequestVerificationToken=${o}`}).then(a=>{if(a.redirected)window.location.href=a.url;else return a.json()}).then(a=>{if(a&&!a.success)y(a.message||"Erro ao remover foto de perfil","error"),e.innerHTML=t,e.style.pointerEvents="auto";else{const n=document.querySelector(".perfil__avatar"),s=n.querySelector("img");if(s){const r=document.querySelector(".perfil__name").textContent.trim().charAt(0).toUpperCase(),c=document.createElement("div");c.className="perfil__avatar-initial",c.innerHTML=`<span>${r}</span>`,s.replaceWith(c)}n.querySelector(".perfil__avatar-upload")?.remove(),n.querySelector(".perfil__avatar-remove")?.remove(),y("Foto de perfil removida com sucesso!","success"),ko("modalConfirmarRemoverFoto")}}).catch(a=>{console.error("Erro ao remover foto de perfil:",a),y("Erro de conexão ao remover foto de perfil","error"),e.innerHTML=t,e.style.pointerEvents="auto"})}function Vo(){const e=document.querySelector('[data-campo="cpf"] .perfil__info-value');if(e){const a=e.textContent.replace(/\D/g,"");a.length===11&&(e.textContent=a.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"))}const t=document.querySelector('[data-campo="telefone"] .perfil__info-value');if(t){const a=t.textContent.replace(/\D/g,"");a.length===11&&(t.textContent=a.replace(/(\d{2})(\d{5})(\d{4})/,"($1) $2-$3"))}const o=document.querySelector('[data-campo="cep"] .perfil__info-value');if(o){const a=o.textContent.replace(/\D/g,"");a.length===8&&(o.textContent=a.replace(/(\d{5})(\d{3})/,"$1-$2"))}}function Wo(e){const t=e.target.files[0];if(!t)return;if(t.size>5*1024*1024){y("A imagem deve ter até 5MB","error"),e.target.value="";return}if(!t.type.startsWith("image/")){y("Por favor, selecione um arquivo de imagem válido","error"),e.target.value="";return}const o=new FormData;o.append("FotoPerfil",t),o.append("__RequestVerificationToken",document.querySelector('input[name="__RequestVerificationToken"]').value);const a=document.querySelector(".perfil__avatar-upload");a&&(a.querySelector("i").className="fas fa-spinner fa-spin"),fetch("/usuario/perfil/atualizarFoto",{method:"POST",body:o,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(n=>n.json()).then(n=>{if(n.success){const s=new FileReader;s.onload=i=>{let r=document.querySelector(".perfil__avatar"),c=r.querySelector(".perfil__avatar-initial"),l=r.querySelector("img");if(c&&!l&&(c.remove(),l=document.createElement("img"),l.alt="Foto de perfil",r.prepend(l)),l&&(l.src=i.target.result),!r.querySelector(".perfil__avatar-upload")){const d=document.createElement("div");d.className="perfil__avatar-upload",d.setAttribute("onclick","document.getElementById('uploadFoto').click()"),d.setAttribute("title","Alterar foto"),d.innerHTML='<i class="fas fa-camera"></i>',r.appendChild(d)}if(!r.querySelector(".perfil__avatar-remove")){const d=document.createElement("div");d.className="perfil__avatar-remove",d.setAttribute("onclick","abrirModal('modalConfirmarRemoverFoto')"),d.setAttribute("title","Remover foto"),d.innerHTML='<i class="fas fa-trash"></i>',r.appendChild(d)}},s.readAsDataURL(t),y("Foto de perfil atualizada com sucesso!","success")}else y(n.message||"Erro ao atualizar a foto de perfil","error")}).catch(n=>{console.error("Error updating profile photo:",n),y("Erro de conexão ao atualizar a foto de perfil","error")}).finally(()=>{const n=document.querySelector(".perfil__avatar-upload");n&&(n.querySelector("i").className="fas fa-camera")})}$(document).ready(function(){$("#selectItensPorPagina").change(function(){var e=$(this).val(),t='@Url.Action("Listar", "Adocao")?pagina=1&itensPorPagina='+e;window.location.href=t}),$(document).on("click",".pagination .page-link",function(e){e.preventDefault();var t=$(this).attr("href");return t&&(window.location.href=t),!1})});toastr.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!0,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};(function(){const e=document.getElementById("btnMenuHamburguer");e&&e.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation();const n=document.querySelector(".menu-lateral"),s=document.querySelector(".menu-sobreposicao");n&&s?(n.classList.toggle("ativo"),s.classList.toggle("ativo"),this.classList.toggle("ativo")):console.error("Elementos do menu lateral não encontrados")});const t=document.querySelector(".menu-sobreposicao");t&&t.addEventListener("click",function(){const a=document.querySelector(".menu-lateral"),n=document.getElementById("btnMenuHamburguer");a&&(a.classList.remove("ativo"),this.classList.remove("ativo"),n&&n.classList.remove("ativo"))});const o=document.getElementById("notificacaoIcone");o&&o.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation();const n=document.getElementById("painel-notificacoes");n?(n.classList.toggle("ativo"),n.style.visibility=n.classList.contains("ativo")?"visible":"hidden",n.style.opacity=n.classList.contains("ativo")?"1":"0",n.style.display=n.classList.contains("ativo")?"block":"none"):console.error("Painel de notificações não encontrado");const s=document.querySelector(".menu-lateral");s&&s.classList.contains("ativo")&&(s.classList.remove("ativo"),document.querySelector(".menu-sobreposicao")?.classList.remove("ativo"),document.getElementById("btnMenuHamburguer")?.classList.remove("ativo"))})})();document.querySelector(".navbar");const we=document.querySelector("#sidebarToggle"),se=document.querySelector(".sidebar"),H=document.querySelector(".sidebar-overlay"),Z=document.querySelector(".notification-icon"),M=document.querySelector(".notification-panel"),Se=document.querySelector(".botao-fechar-notificacoes"),$e=document.querySelector(".botao-marcar-lidas");document.querySelector(".main-content");const Yo=document.querySelectorAll(".etapa-formulario"),b=document.getElementById("formularioAdocao"),Ze=document.querySelectorAll("input[required], textarea[required], select[required]"),w=document.querySelector(".botao-enviar");document.querySelector(".botao-voltar");document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("btnMenuHamburguer");e?e.addEventListener("click",function(){if(typeof alternarMenu=="function")alternarMenu();else{console.error("Função alternarMenu não está disponível");const a=document.querySelector(".menu-lateral"),n=document.querySelector(".menu-sobreposicao");a&&n&&(a.classList.toggle("ativo"),n.classList.toggle("ativo"),this.classList.toggle("ativo"))}}):console.warn("Botão de menu hamburger não encontrado");const t=document.getElementById("notificacaoIcone");t?t.addEventListener("click",function(a){if(a.preventDefault(),a.stopPropagation(),typeof togglePainelNotificacoes=="function")togglePainelNotificacoes();else{console.error("Função togglePainelNotificacoes não está disponível");const n=document.getElementById("painel-notificacoes");n&&(n.classList.toggle("ativo"),n.style.display=n.classList.contains("ativo")?"block":"none")}}):console.warn("Ícone de notificação não encontrado");const o=document.querySelector(".menu-sobreposicao");o&&o.addEventListener("click",function(){if(typeof _=="function")_();else{console.error("Função fecharMenuLateral não está disponível");const a=document.querySelector(".menu-lateral"),n=document.getElementById("btnMenuHamburguer");a&&(a.classList.remove("ativo"),this.classList.remove("ativo"),n&&n.classList.remove("ativo"))}}),Qe(),tt(),ot(),at(),nt(),st(),it(),b&&b.addEventListener("submit",Ke)});function Go(){se.classList.toggle("active"),H.classList.toggle("active"),document.body.classList.toggle("sidebar-open")}function _(){se.classList.remove("active"),H.classList.remove("active"),document.body.classList.remove("sidebar-open")}function Jo(e){e.preventDefault(),e.stopPropagation();const t=Z.getBoundingClientRect();M.style.top=`${t.bottom+window.scrollY+10}px`,M.style.right=`${window.innerWidth-t.right-10}px`,M.classList.toggle("show"),se.classList.contains("active")&&_()}function Xo(){M.classList.remove("show")}function Qe(){const e=document.getElementById("rendaMensal");e&&($(e).maskMoney({prefix:"R$ ",thousands:".",decimal:",",allowZero:!1,allowNegative:!1}),$(e).trigger("mask.maskMoney")),Zo(),Ze.forEach(o=>{o.addEventListener("focus",function(){const a=this.closest(".grupo-formulario");a&&a.classList.add("input-focused")}),o.addEventListener("blur",function(){const a=this.closest(".grupo-formulario");a&&a.classList.remove("input-focused"),this.value.trim()===""||this.classList.contains("moeda-mask")&&this.value==="R$ 0,00"?(this.classList.add("is-invalid"),this.classList.remove("is-valid"),a&&a.classList.add("erro")):(this.classList.remove("is-invalid"),this.classList.add("is-valid"),a&&a.classList.remove("erro"))})}),document.querySelectorAll(".grupo-formulario").forEach(o=>{o.addEventListener("mouseenter",function(){this.style.transform="translateY(-2px)",this.style.backgroundColor="rgba(255, 107, 0, 0.03)"}),o.addEventListener("mouseleave",function(){this.style.transform="translateY(0)",this.style.backgroundColor=""})})}function Zo(){et(),Yo.forEach((e,t)=>{setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)",e.classList.add("animado")},200*(t+1))})}function Qo(){let e=!0;Ze.forEach(a=>{if(a.classList.contains("moeda-mask")){const n=a.value.trim();if(n===""||n==="R$ 0,00"||n==="R$ 0,0"||n==="R$ 0"||n==="R$ ")x(a,"Informe um valor válido para a renda mensal"),e=!1;else{const s=parseFloat(n.replace("R$ ","").replace(/\./g,"").replace(",","."));isNaN(s)||s<=0?(x(a,"O valor da renda mensal deve ser maior que zero"),e=!1):Pe(a)}}else a.value.trim()===""?(x(a,"Este campo é obrigatório"),e=!1):Pe(a)});const t=document.getElementById("qtdMoradores");t&&(t.value===""||parseInt(t.value)<=0)&&(x(t,"Deve ser maior que zero"),e=!1);const o=document.getElementById("termos");return o&&!o.checked&&(x(o,"Você deve aceitar os termos"),e=!1),e}function x(e,t){if(e.classList.add("is-invalid"),e.classList.remove("is-valid"),e.type==="checkbox"||e.type==="radio"){const a=e.closest(".form-check").querySelector(".invalid-feedback");a&&(a.textContent=t)}else{const a=e.nextElementSibling;a&&a.classList.contains("invalid-feedback")&&(a.textContent=t)}const o=e.closest(".grupo-formulario");o&&o.classList.add("erro")}function Pe(e){e.classList.remove("is-invalid"),e.classList.add("is-valid");const t=e.closest(".grupo-formulario");t&&t.classList.remove("erro")}function Ko(){const e=document.getElementById("modalConfirmacao");if(e)if(typeof bootstrap<"u"&&bootstrap.Modal)new bootstrap.Modal(e).show();else{e.style.display="block",e.classList.add("show"),document.body.classList.add("modal-open");const t=document.createElement("div");t.className="modal-backdrop fade show",document.body.appendChild(t)}else console.error("Modal de confirmação não encontrado")}function ea(e){if(e.preventDefault(),!b.checkValidity())return!1;const t=new FormData(b),o=t.get("PetId");if(!b.querySelector("#concordaTermos").checked)return toastr.error("Você precisa concordar com os termos para enviar a solicitação."),!1;w.disabled=!0,w.innerHTML='<i class="fas fa-spinner fa-spin"></i> Enviando...';const a=document.getElementById("tempoDisponivel").value;if(t.set("TempoDisponivel",a),["temQuintal","temVaranda","temRedeProtecao","temAreaExterna","concordaTermos"].forEach(s=>{const i=document.getElementById(s);if(i){const r=s.charAt(0).toUpperCase()+s.slice(1);t.set(r,i.checked)}}),document.getElementById("tevePetSim")&&document.getElementById("tevePetSim").checked?t.set("TevePet","sim"):document.getElementById("tevePetNao")&&document.getElementById("tevePetNao").checked?t.set("TevePet","nao"):t.set("TevePet",""),t.has("RendaMensal")){let s=t.get("RendaMensal");s=s.replace("R$ ","").replace(/\./g,"").replace(",",".");const i=parseFloat(s);isNaN(i)||t.set("RendaMensal",i.toString())}return $.ajax({url:`/usuario/adocao/formulario/${o}`,type:"POST",data:new URLSearchParams(t),processData:!1,contentType:"application/x-www-form-urlencoded",headers:{RequestVerificationToken:t.get("__RequestVerificationToken")},success:function(s){s.success?(toastr.success(s.message),Ko()):(toastr.error(s.message),s.errors&&s.errors.length>0&&s.errors.forEach(function(i){toastr.warning(i)}),w.disabled=!1,w.innerHTML='<i class="fas fa-paw"></i> Enviar Solicitação')},error:function(s,i,r){console.error("Erro na requisição:",r),console.error("Status:",i),console.error("Resposta:",s.responseText),toastr.error("Ocorreu um erro ao enviar o formulário. Por favor, tente novamente."),w.disabled=!1,w.innerHTML='<i class="fas fa-paw"></i> Enviar Solicitação'}}),!1}function Ke(e){if(e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation(),!Qo()){const o=b.querySelector(".is-invalid");return o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.focus()),toastr.error("Por favor, corrija os erros no formulário antes de enviar."),!1}return b.classList.add("was-validated"),ea(e)}function et(){var e=document.querySelectorAll(".etapa-formulario");e.forEach(function(t){t.style.opacity="1",t.style.transform="translateY(0)",t.classList.add("visivel")}),document.body.classList.add("loaded")}document.addEventListener("DOMContentLoaded",function(){if(et(),!b){console.warn("Formulário não encontrado. Esta página pode não conter um formulário de adoção.");return}Qe(),tt(),ot(),at(),nt(),st(),b&&b.addEventListener("submit",function(e){return Ke(e)}),it()});function tt(){const e=document.querySelectorAll(".painel-formulario"),t=document.querySelectorAll(".botao-proximo"),o=document.querySelectorAll(".botao-anterior"),a=document.querySelectorAll(".indicador-progresso");let n=0;e.length>0&&(s(0),i(0)),t.forEach(c=>{c.addEventListener("click",function(l){l.preventDefault(),r()&&(n===e.length-1?b.submit():(s(n+1),i(n)))})}),o.forEach(c=>{c.addEventListener("click",function(l){l.preventDefault(),n>0&&(s(n-1),i(n))})}),a.forEach((c,l)=>{c.addEventListener("click",function(){l<=n+1&&(s(l),i(l))})});function s(c){e.forEach(l=>{l.style.display="none"}),e[c]&&(e[c].style.display="block",e[c].scrollIntoView({behavior:"smooth",block:"start"}),n=c,document.querySelectorAll(".botao-anterior").forEach(l=>{l.style.display=c===0?"none":"inline-block"}),document.querySelectorAll(".botao-proximo").forEach(l=>{l.textContent=c===e.length-1?"Enviar":"Próximo"}))}function i(c){a.forEach((l,d)=>{l.classList.remove("concluido","ativo","pendente"),d<c?l.classList.add("concluido"):d===c?l.classList.add("ativo"):l.classList.add("pendente")})}function r(){const c=e[n].querySelectorAll("[required]");let l=!0;return c.forEach(d=>{d.value.trim()?d.classList.remove("is-invalid"):(d.classList.add("is-invalid"),l=!1)}),l||toastr.error("Por favor, preencha todos os campos obrigatórios."),l}}function ot(){document.querySelectorAll("textarea[data-max-length]").forEach(e=>{const t=parseInt(e.dataset.maxLength),o=document.createElement("div");o.className="contador-caracteres",o.innerHTML=`<span>0</span>/${t}`,e.parentNode.insertBefore(o,e.nextSibling),e.addEventListener("input",function(){const a=this.value.length;o.querySelector("span").textContent=a,a>t?(o.classList.add("excedido"),this.classList.add("is-invalid")):(o.classList.remove("excedido"),this.classList.remove("is-invalid"))})})}function at(){document.querySelectorAll('input[type="number"]').forEach(e=>{const t=document.createElement("div");t.className="controle-numero";const o=document.createElement("button");o.type="button",o.className="btn-numero btn-menos",o.innerHTML='<i class="fas fa-minus"></i>';const a=document.createElement("button");a.type="button",a.className="btn-numero btn-mais",a.innerHTML='<i class="fas fa-plus"></i>',e.parentNode.insertBefore(t,e),t.appendChild(o),t.appendChild(e),t.appendChild(a),o.addEventListener("click",()=>{const n=parseInt(e.value)-1;n>=parseInt(e.min||0)&&(e.value=n,e.dispatchEvent(new Event("change")))}),a.addEventListener("click",()=>{const n=parseInt(e.value)+1;(!e.max||n<=parseInt(e.max))&&(e.value=n,e.dispatchEvent(new Event("change")))})})}function nt(){const e=document.getElementById("tempoDisponivel");if(!e)return;const t=document.getElementById("valorTempoDisponivel");t&&(t.textContent=e.value+" horas",e.addEventListener("input",function(){t.textContent=this.value+" horas"}))}function st(){document.querySelectorAll('.checkbox-personalizado input[type="checkbox"]').forEach(e=>{const t=e.parentElement;e.addEventListener("change",function(){this.checked?t.classList.add("checked"):t.classList.remove("checked")}),e.checked&&t.classList.add("checked")}),document.querySelectorAll('.radio-personalizado input[type="radio"]').forEach(e=>{const t=e.parentElement;e.addEventListener("change",function(){document.querySelectorAll(`input[name="${this.name}"]`).forEach(o=>{o.parentElement.classList.remove("checked")}),this.checked&&t.classList.add("checked")}),e.checked&&t.classList.add("checked")})}function it(){const e=new URLSearchParams(window.location.search),t=e.get("success"),o=e.get("error");t==="true"?toastr.success("Formulário enviado com sucesso! Acompanhe o status da sua adoção na área do usuário."):o&&toastr.error(decodeURIComponent(o))}we&&we.addEventListener("click",Go);H&&H.addEventListener("click",_);Z&&Z.addEventListener("click",Jo);Se&&Se.addEventListener("click",Xo);$e&&$e.addEventListener("click",function(e){e.preventDefault()});Chart.defaults.font.family="'Inter', sans-serif";Chart.defaults.plugins.tooltip.backgroundColor="rgba(17, 24, 39, 0.8)";Chart.defaults.plugins.tooltip.padding=12;Chart.defaults.plugins.tooltip.cornerRadius=8;Chart.defaults.plugins.tooltip.titleFont.size=14;Chart.defaults.plugins.tooltip.bodyFont.size=13;Chart.defaults.plugins.tooltip.displayColors=!1;function ke(e,t="info"){const o=document.createElement("div");o.className=`alerta alerta-${t} fade-in`,o.textContent=e,document.body.appendChild(o),setTimeout(()=>{o.classList.remove("fade-in"),setTimeout(()=>{o.remove()},300)},3e3)}function ta(e){if(e=e.replace(/[^\d]/g,""),e.length!==11||/^(\d)\1+$/.test(e))return!1;let t=0;for(let a=0;a<9;a++)t+=parseInt(e.charAt(a))*(10-a);let o=11-t%11;if(o>9&&(o=0),o!==parseInt(e.charAt(9)))return!1;t=0;for(let a=0;a<10;a++)t+=parseInt(e.charAt(a))*(11-a);return o=11-t%11,o>9&&(o=0),o===parseInt(e.charAt(10))}function oa(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}document.addEventListener("DOMContentLoaded",function(){new bootstrap.Modal(document.getElementById("modalAdmin")),new bootstrap.Modal(document.getElementById("modalPet")),V(),ut();const e=document.getElementById("idadeAnosPet");e&&e.addEventListener("input",function(){Be()});const t=document.getElementById("idadeMesesPet");t&&t.addEventListener("input",function(){Be()});const o=document.getElementById("toggleSenha");o&&o.addEventListener("click",function(){const n=document.getElementById("senha"),s=n.getAttribute("type")==="password"?"text":"password";n.setAttribute("type",s),this.querySelector("i").classList.toggle("fa-eye"),this.querySelector("i").classList.toggle("fa-eye-slash")});const a=document.getElementById("toggleConfirmSenha");a&&a.addEventListener("click",function(){const n=document.getElementById("confirmSenha"),s=n.getAttribute("type")==="password"?"text":"password";n.setAttribute("type",s),this.querySelector("i").classList.toggle("fa-eye"),this.querySelector("i").classList.toggle("fa-eye-slash")}),document.querySelectorAll(".filtro-grafico").forEach(function(n){n.addEventListener("click",function(){document.querySelectorAll(".filtro-grafico").forEach(s=>s.classList.remove("ativo")),this.classList.add("ativo"),ct(this.textContent.trim())})}),document.querySelectorAll(".filtro-grafico-usuarios").forEach(function(n){n.addEventListener("click",function(){document.querySelectorAll(".filtro-grafico-usuarios").forEach(s=>s.classList.remove("ativo")),this.classList.add("ativo"),lt(this.getAttribute("data-periodo"))})})});function rt(e,t,o){const a=o.createLinearGradient(0,0,0,400);return a.addColorStop(0,e),a.addColorStop(1,t),a}function aa(){const e=parseInt(document.getElementById("idadeAnosPet").value)||0,t=parseInt(document.getElementById("idadeMesesPet").value)||0,o=e+t/12;return Math.round(o*10)/10}function Be(){const e=aa();document.getElementById("idadePet").value=e}function q(e){return new Intl.NumberFormat("pt-BR").format(e)}function ct(e){V(e,"Anual")}function lt(e){V("Anual",e)}function V(e="Anual",t="Anual"){document.querySelectorAll(".area-grafico").forEach(o=>{o.innerHTML=`
            <div class="carregando-grafico">
                Carregando dados...
            </div>
        `}),fetch(`/GerenciamentoDashboard/DadosGraficos?periodoAdocoes=${encodeURIComponent(e)}&periodoUsuarios=${encodeURIComponent(t)}`).then(o=>{if(!o.ok)throw new Error("Falha ao carregar dados dos gráficos");return o.json()}).then(o=>{if(!o||typeof o!="object")throw new Error("Formato de dados inválido");try{const a=(o.adocoesPorMes||[]).map(r=>({mes:r.Mes||r.mes,total:r.Quantidade??r.total})),n=(o.especiesDistribuicao||o.petsEspecie||[]).map(r=>({especie:r.Especie||r.especie,total:r.Quantidade??r.total})),s=(o.usuariosPorMes||[]).map(r=>({mes:r.Mes||r.mes,total:r.Quantidade??r.total})),i=(o.statusFormularios||[]).map(r=>({status:r.Status||r.status,total:r.Quantidade??r.total}));a.length&&na(a,e),n.length&&sa(n),s.length&&ia(s,t),i.length&&ra(i),o.estatisticas&&ca(o.estatisticas)}catch(a){console.error("Erro ao processar dados dos gráficos:",a),document.querySelectorAll(".area-grafico").forEach(n=>{n.innerHTML=`
                        <div class="erro-grafico">
                            Erro ao processar dados. Tente novamente.
                        </div>
                    `})}}).catch(o=>{console.error("Erro ao carregar dados dos gráficos:",o),document.querySelectorAll(".area-grafico").forEach(a=>{a.innerHTML=`
                    <div class="erro-grafico">
                        ${o.message||"Erro ao carregar dados. Tente novamente."}
                    </div>
                `})})}function na(e,t){const o=document.getElementById("graficoAdocoesMes");if(!o)return;const a=dt(e,t),n=o.getContext("2d");window.graficoAdocoes&&window.graficoAdocoes.destroy();const s=rt("rgba(99, 102, 241, 0.8)","rgba(99, 102, 241, 0.2)",n);window.graficoAdocoes=new Chart(n,{type:"bar",data:{labels:a.map(i=>i.mes),datasets:[{label:"Adoções",data:a.map(i=>i.total),backgroundColor:s,borderColor:"#6366F1",borderWidth:1,borderRadius:6,barThickness:20,maxBarThickness:30}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(i){return`Total: ${q(i.raw)}`}}}},scales:{y:{beginAtZero:!0,grid:{drawBorder:!1,color:"rgba(200, 200, 200, 0.15)"},ticks:{font:{size:11}}},x:{grid:{display:!1},ticks:{font:{size:11}}}}}})}function sa(e){const t=document.getElementById("graficoPetsEspecie");if(!t)return;const o=t.getContext("2d");window.graficoPetsEspecie&&window.graficoPetsEspecie.destroy();const a=["#6366F1","#10B981","#F59E0B","#EF4444"];window.graficoPetsEspecie=new Chart(o,{type:"doughnut",data:{labels:e.map(n=>n.especie),datasets:[{data:e.map(n=>n.total),backgroundColor:a,borderColor:"#FFFFFF",borderWidth:2,hoverOffset:5}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"65%",plugins:{legend:{position:"bottom",labels:{usePointStyle:!0,padding:20,font:{size:12}}},tooltip:{callbacks:{label:function(n){const s=n.label||"",i=n.raw||0,r=n.dataset.data.reduce((l,d)=>l+d,0),c=Math.round(i/r*100);return`${s}: ${q(i)} (${c}%)`}}}}}})}function ia(e,t){const o=document.getElementById("graficoUsuariosMes");if(!o)return;const a=dt(e,t),n=o.getContext("2d");window.graficoUsuarios&&window.graficoUsuarios.destroy();const s=rt("rgba(16, 185, 129, 0.7)","rgba(16, 185, 129, 0.05)",n);window.graficoUsuarios=new Chart(n,{type:"line",data:{labels:a.map(i=>i.mes),datasets:[{label:"Novos Usuários",data:a.map(i=>i.total),backgroundColor:s,borderColor:"#10B981",borderWidth:2,pointBackgroundColor:"#FFFFFF",pointBorderColor:"#10B981",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6,tension:.2,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(i){return`Total: ${q(i.raw)}`}}}},scales:{y:{beginAtZero:!0,grid:{drawBorder:!1,color:"rgba(200, 200, 200, 0.15)"},ticks:{font:{size:11}}},x:{grid:{display:!1},ticks:{font:{size:11}}}}}})}function ra(e){const t=document.getElementById("graficoStatusFormularios");if(!t)return;const o=t.getContext("2d");window.graficoStatusFormularios&&window.graficoStatusFormularios.destroy();const a={Aprovada:"#22C55E",Rejeitada:"#EF4444",Pendente:"#F59E0B","Em Análise":"#6366F1",Cancelada:"#6B7280"},n=e.map(r=>r.status),s=e.map(r=>r.total),i=e.map(r=>a[r.status]||"#6B7280");window.graficoStatusFormularios=new Chart(o,{type:"polarArea",data:{labels:n,datasets:[{data:s,backgroundColor:i,borderColor:"#FFFFFF",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{usePointStyle:!0,padding:20,font:{size:12}}},tooltip:{callbacks:{label:function(r){const c=r.label||"",l=r.raw||0,d=r.dataset.data.reduce((f,v)=>f+v,0),u=Math.round(l/d*100);return`${c}: ${q(l)} (${u}%)`}}}},scales:{r:{ticks:{display:!1},grid:{color:"rgba(200, 200, 200, 0.2)"},angleLines:{color:"rgba(200, 200, 200, 0.2)"}}}}})}function dt(e,t){const o=new Date,a=o.getMonth(),n=o.getFullYear();switch(t){case"Trimestral":return e.filter(s=>{const[i,r]=s.mes.split("/"),c=new Date(parseInt(r),parseInt(i)-1,1),l=new Date(n,a-2,1);return c>=l});case"Semestral":return e.filter(s=>{const[i,r]=s.mes.split("/"),c=new Date(parseInt(r),parseInt(i)-1,1),l=new Date(n,a-5,1);return c>=l});default:return e}}function ca(e){const t={totalCachorros:document.getElementById("total-cachorros"),totalGatos:document.getElementById("total-gatos"),formulariosAprovados:document.getElementById("formularios-aprovados"),formulariosPendentes:document.getElementById("formularios-pendentes")};for(const[o,a]of Object.entries(t))a&&e[o]!==void 0&&la(a,0,e[o])}function la(e,t,o){const s=(o-t)/50;let i=t;e.classList.add("animando");const r=setInterval(()=>{i+=s,i>=o&&(clearInterval(r),i=o,setTimeout(()=>{e.classList.remove("animando")},300)),e.textContent=q(Math.floor(i))},30)}function da(){let e=!0;const t={nome:document.getElementById("nomeAdmin"),email:document.getElementById("emailAdmin"),cpf:document.getElementById("cpfAdmin"),telefone:document.getElementById("telefoneAdmin"),senha:document.getElementById("senhaAdmin"),confirmSenha:document.getElementById("confirmarSenhaAdmin")};return t.nome.value.trim()||(S(t.nome,"O nome é obrigatório"),e=!1),oa(t.email.value.trim())||(S(t.email,"Email inválido"),e=!1),ta(t.cpf.value.trim())||(S(t.cpf,"CPF inválido"),e=!1),t.telefone.value.trim()||(S(t.telefone,"Telefone é obrigatório"),e=!1),t.senha&&t.confirmSenha&&(t.senha.value?t.senha.value!==t.confirmSenha.value&&(S(t.confirmSenha,"As senhas não coincidem"),e=!1):(S(t.senha,"Senha é obrigatória"),e=!1)),e}function ua(){confirm("Tem certeza que deseja sair do sistema?")&&fetch("/Autenticacao/Logout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")}}).then(e=>{e.ok?window.location.href="/Login":ke("Erro ao realizar logout. Tente novamente.","erro")}).catch(e=>{console.error("Erro ao fazer logout:",e),ke("Erro ao realizar logout. Tente novamente.","erro")})}function ut(){const e=document.querySelector(".lista-atividade");e&&(e.innerHTML='<div class="text-center p-3"><i class="fas fa-spinner fa-spin me-2"></i> Carregando atividades...</div>',fetch("/GerenciamentoDashboard/AtividadesRecentes").then(t=>{if(!t.ok)throw new Error("Falha ao carregar atividades recentes");return t.json()}).then(t=>{Array.isArray(t)&&t.length>0?ma(e,t):e.innerHTML='<div class="text-center p-3">Nenhuma atividade recente encontrada.</div>'}).catch(t=>{console.error("Erro ao carregar atividades recentes:",t),e.innerHTML='<div class="text-center p-3 text-danger"><i class="fas fa-exclamation-circle me-2"></i> Erro ao carregar atividades.</div>'}))}function ma(e,t){e.innerHTML="",t.slice(0,5).forEach(a=>{let n="usuario",s="fa-user";switch(a.tipo.toLowerCase()){case"adocao":n="adocao",s="fa-heart";break;case"pet":n="pet",s="fa-paw";break;case"usuario":n="usuario",s="fa-user";break}const i=document.createElement("div");i.className="item-atividade",i.innerHTML=`
            <div class="icone-atividade ${n}">
                <i class="fas ${s}"></i>
            </div>
            <div class="conteudo-atividade">
                <div class="acao-atividade">${a.descricao}</div>
                <div class="data-atividade">${fa(a.data)}</div>
            </div>
        `,e.appendChild(i)})}function fa(e){const t=new Date(e),a=new Date-t,n=Math.floor(a/1e3),s=Math.floor(n/60),i=Math.floor(s/60),r=Math.floor(i/24);return n<60?"Agora mesmo":s<60?`${s} ${s===1?"minuto":"minutos"} atrás`:i<24?`${i} ${i===1?"hora":"horas"} atrás`:r<7?`${r} ${r===1?"dia":"dias"} atrás`:t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}function S(e,t){e.classList.add("is-invalid");const o=document.getElementById(`${e.id}-erro`);o&&(o.textContent=t)}function pa(){V(),document.querySelectorAll("#filtro-adocoes button").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll("#filtro-adocoes button").forEach(t=>{t.classList.remove("active")}),this.classList.add("active"),ct(this.dataset.filtro)})}),document.querySelectorAll("#filtro-usuarios button").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll("#filtro-usuarios button").forEach(t=>{t.classList.remove("active")}),this.classList.add("active"),lt(this.dataset.filtro)})})}function ga(){pa(),ut(),va();const e=document.getElementById("botao-logout");e&&e.addEventListener("click",ua);const t=document.getElementById("alternar-senha");t&&t.addEventListener("click",function(){const a=document.getElementById("senhaAdmin");a&&(a.type==="password"?(a.type="text",this.innerHTML='<i class="fas fa-eye-slash"></i>'):(a.type="password",this.innerHTML='<i class="fas fa-eye"></i>'))});const o=document.getElementById("alternar-confirm-senha");o&&o.addEventListener("click",function(){const a=document.getElementById("confirmarSenhaAdmin");a&&(a.type==="password"?(a.type="text",this.innerHTML='<i class="fas fa-eye-slash"></i>'):(a.type="password",this.innerHTML='<i class="fas fa-eye"></i>'))})}function va(){const e=document.getElementById("formAdmin");e&&e.addEventListener("submit",function(o){o.preventDefault(),da()&&this.submit()});const t=document.getElementById("modalAdmin");t&&t.addEventListener("hidden.bs.modal",function(){e.reset(),document.querySelectorAll(".is-invalid").forEach(o=>{o.classList.remove("is-invalid")})})}document.addEventListener("DOMContentLoaded",function(){ga()});$(document).ready(function(){ya(),ha(),Ea(),ba(),typeof $.fn.mask=="function"&&($(".mascara-cpf").mask("000.000.000-00"),$(".mascara-telefone").mask("(00) 00000-0000")),Pa(),$("#btnNovoColaborador").on("click",function(){Ia("criar")}),$("#btnFiltrarColaboradores").on("click",Sa),$("#btnLimparFiltros").on("click",$a),$("#formularioColaborador").on("submit",function(e){e.preventDefault(),Ca()&&wa()}),$("#botaoConfirmarDesativar").on("click",async function(){const e=$("#idDesativar").val(),t=$('input[name="__RequestVerificationToken"]').val();try{const a=await(await fetch(`/Admin/Colaboradores/DesativarColaborador/${e}`,{method:"POST",headers:{"Content-Type":"application/json",RequestVerificationToken:t},body:JSON.stringify({})})).json();a.sucesso?(E(a.mensagem,"success"),$("#modalDesativar").modal("hide"),setTimeout(()=>window.location.reload(),1e3)):E(a.mensagem,"error")}catch(o){console.error(o),E("Erro na comunicação com o servidor","error")}}),$("#botaoConfirmarExcluir").on("click",async function(){const e=$("#idExcluir").val(),t=$('input[name="__RequestVerificationToken"]').val();try{const a=await(await fetch(`/Admin/Colaboradores/ExcluirColaborador/${e}`,{method:"POST",headers:{"Content-Type":"application/json",RequestVerificationToken:t},body:JSON.stringify({})})).json();a.sucesso?(E(a.mensagem,"success"),$("#modalExcluir").modal("hide"),setTimeout(()=>window.location.reload(),1e3)):E(a.mensagem,"error")}catch(o){console.error(o),E("Erro na comunicação com o servidor","error")}}),$(".pagination .page-link").on("click",function(e){e.preventDefault();var t=$(this).attr("href");t&&(window.location.href=t)})});function ya(){$("input, select, textarea").on("input change focus",function(){$(this).removeClass("is-invalid");const e=$(this).attr("id")+"-erro";$("#"+e).text("")}),$(document).on("click",".mensagem-erro",function(){$(this).text(""),$(this).siblings("input, select, textarea").removeClass("is-invalid")})}function ha(){toastr.options={closeButton:!0,positionClass:"toast-top-right",showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"}}function Ea(){var e=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));e.map(function(o){return new bootstrap.Tooltip(o)});var t=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));t.map(function(o){return new bootstrap.Popover(o)})}function ba(){const e=$("#modalColaborador");e.on("show.bs.modal",function(){typeof $.fn.mask=="function"&&($(this).find(".mascara-cpf").mask("000.000.000-00"),$(this).find(".mascara-telefone").mask("(00) 00000-0000")),e.find(".form-floating").each(function(t){const o=$(this);setTimeout(function(){o.css({opacity:1,transform:"translateY(0)"})},t*50)})}),e.on("hidden.bs.modal",function(){mt(),e.find(".form-floating").css({opacity:0,transform:"translateY(10px)"})}),$(".toggle-password").on("click",function(){La($(this).data("target"))}),$("#colaboradorImagem").on("change",function(t){const o=t.target.files[0],a=$(".admin-avatar-container");if(o){const n=new FileReader;a.find("img, .success-overlay").remove(),a.append('<div class="loading-overlay"><i class="bi bi-arrow-repeat spin"></i></div>'),n.onload=function(s){setTimeout(()=>{a.find(".loading-overlay").remove();const i=$("<img>").attr("src",s.target.result);a.append(i);const r=$('<div class="success-overlay"><i class="bi bi-check-lg"></i></div>');a.append(r),setTimeout(()=>r.fadeOut(300,function(){$(this).remove()}),1e3)},500)},n.readAsDataURL(o)}}),$("#colaboradorAtivo").on("change",function(){const t=$(this).siblings(".form-check-label");$(this).is(":checked")?t.text("Colaborador ativo").css("color","var(--success)"):t.text("Colaborador inativo").css("color","#6c757d")})}function Ia(e,t=null){mt();const o=$("#modalColaborador"),a=o.find(".modal-header");switch(a.css("background",""),e){case"criar":a.css("background",getComputedStyle(document.documentElement).getPropertyValue("--primary-gradient")),$("#tituloModalColaborador").html('<i class="fas fa-user-plus me-2 text-white"></i> Novo Colaborador'),$("#colaboradorId").val("0"),$("#formularioColaborador").attr("action","/Admin/Colaboradores/CadastrarColaborador"),$("#containerSenhaAtual").hide(),$("#containerSenha").show(),$("#linhaConfirmarSenha").show(),$("#colaboradorAtivo").prop("checked",!0).trigger("change"),G(!0),$(".botao-modo-edicao").show(),$(".botao-modo-visualizacao").hide(),$("#botaoSalvarColaborador").html('<i class="fas fa-save me-2"></i> Cadastrar');break;case"editar":if(a.css("background",getComputedStyle(document.documentElement).getPropertyValue("--success-gradient")),!t){console.error("ID do colaborador não fornecido para edição");return}$("#tituloModalColaborador").html('<i class="fas fa-user-edit me-2 text-white"></i> Editar Colaborador'),$("#colaboradorId").val(t),$("#formularioColaborador").attr("action","/Admin/Colaboradores/AtualizarColaborador"),$("#containerSenhaAtual").show(),$("#containerSenha").show(),$("#linhaConfirmarSenha").show(),G(!0),$(".botao-modo-edicao").show(),$(".botao-modo-visualizacao").hide(),$("#botaoSalvarColaborador").html('<i class="fas fa-save me-2"></i> Salvar Alterações'),xe(t);break;case"visualizar":if(a.css("background",getComputedStyle(document.documentElement).getPropertyValue("--accent-gradient")),!t){console.error("ID do colaborador não fornecido para visualização");return}$("#tituloModalColaborador").html('<i class="fas fa-eye me-2 text-white"></i> Detalhes do Colaborador'),$("#colaboradorId").val(t),$("#containerSenhaAtual").hide(),$("#containerSenha").hide(),$("#linhaConfirmarSenha").hide(),G(!1),$(".botao-modo-edicao").hide(),$(".botao-modo-visualizacao").hide(),xe(t);break;default:console.error("Modo inválido para o modal de colaborador");return}o.modal("show")}function G(e){$("#formularioColaborador").find("input, select, textarea").each(function(){$(this).prop("readonly",!e),$(this).prop("disabled",!e)}),e&&$("#colaboradorId").val()!=="0"&&$("#colaboradorEmail").prop("readonly",!0)}async function xe(e){try{const t=await fetch(`/Admin/Colaboradores/ObterColaborador/${e}`);if(!t.ok)throw new Error(`Erro HTTP: ${t.status}`);const o=await t.json();if(o.sucesso){const a=o.dados;if($("#nomeColaborador").val(a.nome),$("#emailColaborador").val(a.email),$("#cpfColaborador").val(a.cpf).trigger("input"),$("#telefoneColaborador").val(a.telefone).trigger("input"),$("#cargoColaborador").val(a.cargo),$("#colaboradorAtivo").prop("checked",a.ativo).trigger("change"),a.imagemUrl){const n=$(".admin-avatar-container");n.find("img").remove(),n.append($("<img>").attr("src",a.imagemUrl))}}else console.error("Erro ao obter dados:",o.mensagem||"Erro desconhecido"),E(`Erro ao carregar dados: ${o.mensagem||"Erro desconhecido"}`,"error")}catch(t){console.error("Erro ao carregar dados do colaborador:",t),E(`Erro ao carregar dados: ${t.message}`,"error")}}function mt(){$("#formularioColaborador")[0].reset(),$("#formularioColaborador").find("input, select, textarea").removeClass("is-valid is-invalid"),$(".mensagem-erro").text("").hide(),$(".admin-avatar-container").find("img, .success-overlay, .loading-overlay").remove()}function La(e){const t=$("#"+e),o=$('button[data-target="'+e+'"]'),a=t.attr("type")==="password"?"text":"password";t.attr("type",a),o.find("i").toggleClass("bi-eye bi-eye-slash"),o.addClass("btn-clicked"),setTimeout(()=>o.removeClass("btn-clicked"),200)}function Ca(){let e=!0;const t=[{id:"nomeColaborador",min:3,mensagem:"O nome deve ter pelo menos 3 caracteres"},{id:"emailColaborador",regex:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,mensagem:"Digite um email válido"},{id:"cpfColaborador",mensagem:"CPF inválido"},{id:"telefoneColaborador",mensagem:"Telefone inválido"},{id:"cargoColaborador",mensagem:"Selecione um cargo"}],o=$("#colaboradorId").val()==="0";return o&&t.push({id:"senhaColaborador",min:6,mensagem:"A senha deve ter pelo menos 6 caracteres"}),t.forEach(a=>{const n=$("#"+a.id);if(!n.length){console.warn(`Campo de validação '${a.id}' não encontrado, pulando.`);return}let s=!0;if(!n.is(":visible"))return;const i=n.val(),r=i!=null?i.toString():"";if(a.min&&r.trim().length<a.min&&(s=!1),a.regex&&!a.regex.test(r.trim())&&(s=!1),a.id==="cpfColaborador"){const c=n.val()||"";U(c).length!==11&&(s=!1)}if(a.id==="telefoneColaborador"&&n.val()&&(s=U(n.val()).length>=10),a.id==="senhaColaborador"&&o){const c=n.val(),l=$("#confirmarSenhaColaborador").val();c!==l?($("#confirmarSenhaColaborador").addClass("is-invalid"),$("#confirmarSenhaColaborador-erro").text("As senhas não coincidem").show(),e=!1):($("#confirmarSenhaColaborador").removeClass("is-invalid"),$("#confirmarSenhaColaborador-erro").text("").hide())}s?(n.removeClass("is-invalid"),$("#"+a.id+"-erro").text("").hide()):(n.addClass("is-invalid"),$("#"+a.id+"-erro").text(a.mensagem).show(),e=!1)}),e}function U(e){return e.replace(/[^\d]/g,"")}async function wa(){try{const e=$("#formularioColaborador"),t=$("#cpfColaborador");t.length&&t.val(U(t.val()));const o=$("#telefoneColaborador");o.length&&o.val(U(o.val()));const a=new FormData(e[0]),n=e.attr("action"),s=$("#botaoSalvarColaborador"),i=s.html();s.html('<i class="bi bi-arrow-repeat spin me-2"></i>Salvando...').prop("disabled",!0);const c=await(await fetch(n,{method:"POST",body:a})).json();s.html(i).prop("disabled",!1),c.sucesso?($("#modalColaborador").modal("hide"),E(c.mensagem||"Operação realizada com sucesso!","success"),setTimeout(()=>{window.location.reload()},1e3)):(E(c.mensagem||"Ocorreu um erro ao processar a solicitação","error"),c.erros&&Object.keys(c.erros).forEach(l=>{const d=$("#"+l),u=c.erros[l];d.addClass("is-invalid"),$("#"+l+"-erro").text(u).show()}))}catch(e){console.error("Erro ao enviar formulário:",e),E("Erro na comunicação com o servidor","error"),$("#botaoSalvarColaborador").html('<i class="fas fa-save me-2"></i>Salvar').prop("disabled",!1)}}$(document).on("click","#botaoConfirmarStatus",async function(){const e=$("#idStatus").val(),t=$('input[name="__RequestVerificationToken"]').val(),o=`/Admin/Colaboradores/DesativarColaborador/${e}`;try{const n=await(await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",RequestVerificationToken:t}})).json();n.sucesso?(E(n.mensagem,"success"),$("#modalStatus").modal("hide"),setTimeout(()=>window.location.reload(),1e3)):E(n.mensagem,"error")}catch(a){console.error(a),E("Erro na comunicação com o servidor","error")}});function Sa(){const e=$("#filtroNome").val().trim(),t=$("#filtroCargo").val(),o=$("#filtroStatus").val();let a="/Admin/Colaboradores?";e&&(a+=`nome=${encodeURIComponent(e)}&`),t&&(a+=`cargo=${encodeURIComponent(t)}&`),o&&(a+=`status=${encodeURIComponent(o)}&`),window.location.href=a.slice(0,-1)}function $a(){$("#filtroNome").val(""),$("#filtroCargo").val(""),$("#filtroStatus").val(""),window.location.href="/Admin/Colaboradores"}function Pa(){try{const e=$("#colaboradorCargo"),t=$("#filtroCargo");if(!e.length&&!t.length)return;fetch("/Admin/Colaboradores/ObterCargos").then(o=>{if(!o.ok)throw new Error(`Erro HTTP: ${o.status}`);return o.json()}).then(o=>{if(o.sucesso){const a=o.dados;if(e.length&&(e.empty(),e.append('<option value="">Selecione um cargo</option>'),a.forEach(n=>{e.append(`<option value="${n.id}">${n.nome}</option>`)})),t.length){const n=t.val();t.empty(),t.append('<option value="">Todos os cargos</option>'),a.forEach(s=>{t.append(`<option value="${s.id}">${s.nome}</option>`)}),n&&t.val(n)}}else console.error("Erro ao obter cargos:",o.mensagem||"Erro desconhecido")}).catch(o=>{console.error("Erro ao carregar cargos:",o)})}catch(e){console.error("Erro ao preencher dropdown de cargos:",e)}}function E(e,t="success"){const o=document.querySelector(".notificacao");o&&o.remove();const a=document.createElement("div");a.className=`notificacao notificacao-${t}`;let n=t==="success"?"bi-check-circle-fill":"bi-exclamation-triangle",s=t==="success"?"Sucesso!":"Erro";a.innerHTML=`
        <div class="notificacao-icone">
            <i class="bi ${n}"></i>
        </div>
        <div class="notificacao-conteudo">
            <h5 class="mb-0 fw-bold">${s}</h5>
            <p>${e}</p>
        </div>
        <button class="notificacao-fechar">
            <i class="bi bi-x"></i>
        </button>
    `,document.body.appendChild(a),setTimeout(()=>{a.classList.add("notificacao-show")},10),a.querySelector(".notificacao-fechar").addEventListener("click",function(){a.classList.remove("notificacao-show"),setTimeout(()=>{a.remove()},300)}),setTimeout(()=>{a.parentNode&&(a.classList.remove("notificacao-show"),setTimeout(()=>{a.parentNode&&a.remove()},300))},5e3)}$(document).ready(function(){$(".pagination .page-link").on("click",function(e){e.preventDefault();var t=$(this).attr("href");return t&&(window.location.href=t),!1}),$(document).on("click",".pagination .page-link",function(e){e.preventDefault();var t=$(this).attr("href");return t&&(window.location.href=t),!1}),$("#modalDetalhesFormulario").on("hide.bs.modal",function(e){const t=$("#observacaoAdmin").val();qe==="Pendente"&&t&&t!==Ae&&(confirm("Você tem observações não salvas. Deseja realmente sair?")||e.preventDefault())}),$("#modalDetalhesFormulario").on("hidden.bs.modal",function(){$("#observacaoAdmin").val(""),Ae="",qe=""})});function ka(){const e=$("#campoPesquisaForm").val().toLowerCase(),t=$("#filtroStatus").val(),o=$("#filtroData").val(),a=new Date;a.setHours(0,0,0,0);const n=new Date;n.setDate(n.getDate()-7);const s=new Date;s.setDate(s.getDate()-30),$("table tbody tr").each(function(){const i=$(this),r=i.find(".nome-cliente").text().toLowerCase(),c=i.find('small:contains("@")').text().toLowerCase(),l=i.find('small:contains("fa-map-marker-alt")').text().toLowerCase(),d=i.find(".indicador-status").text().toLowerCase(),u=i.find(".data").text();let f=!0;if(o){const C=Ba(u);o==="hoje"?f=C>=a:o==="7dias"?f=C>=n:o==="30dias"&&(f=C>=s)}const v=r.includes(e)||c.includes(e)||l.includes(e),B=!t||d===t.toLowerCase();v&&B&&f?i.show():i.hide()}),xa()}function Ba(e){const t=e.split(" ")[0].split("/");return new Date(t[2],t[1]-1,t[0])}function xa(){[{container:".tabela-formularios",mensagem:".mensagem-sem-formularios"}].forEach(t=>{$(`${t.container} tbody tr:visible`).length===0?$(t.mensagem).show():$(t.mensagem).hide()})}$("#campoPesquisaForm, #filtroStatus, #filtroData").on("input change",ka);let Ae="",qe="",Q,k,A;function K(){document.querySelectorAll(".modal-backdrop").forEach(e=>{e.remove()}),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""}function Aa(){const t=new URLSearchParams(window.location.search).get("visualizarPet");t&&setTimeout(()=>{te(t)},500)}toastr.options={closeButton:!0,progressBar:!0,positionClass:"toast-top-right",timeOut:"5000"};document.addEventListener("DOMContentLoaded",function(){try{const e=document.getElementById("modalPet"),t=document.getElementById("modalDetalhesPet"),o=document.getElementById("modalConfirmacaoExclusao");e&&(Q=new bootstrap.Modal(e)),t&&(k=new bootstrap.Modal(t)),o&&(A=new bootstrap.Modal(o))}catch(e){console.error("Erro ao inicializar modais:",e)}K(),typeof bootstrap>"u"&&(console.error("Bootstrap não está carregado. Os modais podem não funcionar."),toastr.error("Erro ao carregar recursos da página. Por favor, atualize a página.")),vt(),oe(),ee(),Fa(),ae(),Va(),ja(),Aa(),Ua()});function qa(){$(".paginacao-container").css("display","block"),$(".paginacao-info").css("display","flex"),$(".itens-por-pagina").css("display","flex");const t=new URLSearchParams(window.location.search).get("itensPorPagina"),o=localStorage.getItem("adminPetsItensPorPagina");t?$("#selectItensPorPagina").val(t):o&&$("#selectItensPorPagina").val(o);const a=$("#selectItensPorPagina").val();$("#listaPets").attr("data-itens",a),$("#selectItensPorPagina").off("change").on("change",function(){const n=$(this).val(),s=new URL(window.location.href);localStorage.setItem("adminPetsItensPorPagina",n),s.searchParams.set("itensPorPagina",n),s.searchParams.set("pagina",1);const i={};document.querySelectorAll(".imagem-pet").forEach(r=>{if(r.src&&r.complete&&!r.naturalWidth==0){const c=r.closest(".cartao-pet")?.getAttribute("data-id");c&&(i[c]=r.src)}}),sessionStorage.setItem("imagensPets",JSON.stringify(i)),$(".cartao-pet").addClass("mudando-layout"),setTimeout(()=>{window.location.href=s.toString()},300)})}function ft(){try{const e=sessionStorage.getItem("imagensPets");if(!e)return;const t=JSON.parse(e);document.querySelectorAll(".cartao-pet").forEach(o=>{const a=o.getAttribute("data-id");if(!a||!t[a])return;const n=o.querySelector(".imagem-pet");if(n&&(!n.src||n.style.display==="none")){n.src=t[a],n.style.display="block";const s=o.querySelector(".sem-imagem");s&&(s.style.display="none")}})}catch(e){console.error("Erro ao restaurar imagens:",e)}}function ee(){ft(),document.querySelectorAll(".imagem-pet").forEach(e=>{if(e.complete&&e.naturalWidth>0&&e.style.display!=="none")return;const t=e.getAttribute("src");t&&(e.removeAttribute("src"),setTimeout(()=>{e.setAttribute("src",t)},50),e.onload=function(){e.style.display="block";const o=e.closest(".container-imagem");o&&o.querySelector(".sem-imagem")&&(o.querySelector(".sem-imagem").style.display="none");const a=e.closest(".cartao-pet")?.getAttribute("data-id");if(a)try{const n=JSON.parse(sessionStorage.getItem("imagensPets")||"{}");n[a]=e.src,sessionStorage.setItem("imagensPets",JSON.stringify(n))}catch{}},e.onerror=function(){e.style.display="none";const o=e.closest(".container-imagem");if(o)if(o.querySelector(".sem-imagem"))o.querySelector(".sem-imagem").style.display="flex";else{const a=document.createElement("div");a.className="sem-imagem",o.appendChild(a)}})})}function Ta(){if(Ya(),window.location.pathname.includes("/Admin/GerenciamentoPets/Details/")){$(".carousel").carousel();return}$(".pets-grid").length!==0&&(carregarPets(),Ga(),vt(),setTimeout(pt,1e4))}function pt(){$(".carregando-overlay").fadeOut(300,function(){$(this).remove()}),$(".pets-grid").addClass("layout-pronto")}$(document).ready(function(){Ta(),setTimeout(pt,5e3)});async function Na(){const e=document.querySelector('[data-required-for-draft="true"]');if(!e||!e.value.trim()){toastr.error("Por favor, informe o nome do pet para salvar como rascunho.");return}try{document.getElementById("statusPet").value="Rascunho";const t=document.querySelectorAll('[data-required-for-complete="true"]'),o=new Map;t.forEach(i=>{o.set(i,i.hasAttribute("required")),i.removeAttribute("required")});const a=new FormData(document.getElementById("formPet"));a.append("CadastroCompleto","false"),["Especie","Raca","Sexo","Porte","Descricao"].forEach(i=>{(!a.has(i)||a.get(i)===null||a.get(i)==="null")&&a.set(i,"")}),(!a.has("Anos")||a.get("Anos")===null||isNaN(a.get("Anos")))&&a.set("Anos","0"),(!a.has("Meses")||a.get("Meses")===null||isNaN(a.get("Meses")))&&a.set("Meses","0");const s=document.getElementById("petId").value;s&&s!=="0"&&a.append("ManterImagemAtual","true"),a.has("UsuarioId")||a.append("UsuarioId","1"),await gt(a,!0),t.forEach(i=>{o.get(i)&&i.setAttribute("required","")})}catch(t){console.error("Erro ao salvar rascunho:",t),toastr.error("Ocorreu um erro ao salvar o rascunho. Por favor, tente novamente.")}}async function Ma(){const e=document.getElementById("formPet"),t=document.getElementById("petId").value,o=t&&t!=="0";if(!Da()){toastr.error("Por favor, preencha todos os campos obrigatórios.");return}try{const a=new FormData(e);if(a.append("CadastroCompleto","true"),o){const s=document.getElementById("previewImagem"),i=document.getElementById("fotoPet");s.style.display!=="none"&&(!i.files||i.files.length===0)&&a.append("ManterImagemAtual","true")}a.has("UsuarioId")||a.append("UsuarioId","1"),["Especie","Raca","Sexo","Porte","Descricao"].forEach(s=>{(!a.has(s)||a.get(s)===null||a.get(s)==="null")&&a.set(s,"")}),(!a.has("Anos")||a.get("Anos")===null||isNaN(a.get("Anos")))&&a.set("Anos","0"),(!a.has("Meses")||a.get("Meses")===null||isNaN(a.get("Meses")))&&a.set("Meses","0"),await gt(a,!1)}catch(a){console.error("Erro ao salvar pet:",a),toastr.error("Ocorreu um erro ao salvar o pet. Por favor, tente novamente.")}}async function Da(){document.getElementById("formPet");let e=!0;const t=document.getElementById("petId").value;document.querySelectorAll(".mensagem-erro").forEach(d=>{d.style.display="none"});const o=document.getElementById("nomePet");if(o&&o.value.trim().length>0)try{const u=await(await fetch(`/admin/pets/verificar-nome?nome=${encodeURIComponent(o.value.trim())}&id=${t}`)).json();if(!u.disponivel){o.classList.add("is-invalid");const f=o.parentElement.querySelector(".mensagem-erro");f&&(f.textContent=u.mensagem,f.style.display="block"),e=!1}}catch(d){console.error("Erro ao verificar nome:",d)}["especiePet","racaPet","sexoPet","portePet","descricaoPet"].forEach(d=>{const u=document.getElementById(d);if(!u||!u.value.trim()){e=!1;const f=u.parentElement.querySelector(".mensagem-erro");f&&(f.style.display="block")}});const n=parseInt(document.getElementById("anosPet").value)||0,s=parseInt(document.getElementById("mesesPet").value)||0;(n<0||n>30)&&(e=!1,document.getElementById("anosPet").parentElement.parentElement.querySelector(".mensagem-erro").style.display="block"),(s<0||s>11)&&(e=!1,document.getElementById("mesesPet").parentElement.parentElement.querySelector(".mensagem-erro").style.display="block"),n===0&&s===0&&(e=!1,toastr.error("A idade do pet deve ser maior que zero."));const i=document.getElementById("previewImagem"),r=document.getElementById("fotoPet"),c=i&&i.style.display!=="none"&&i.src,l=r&&r.files&&r.files.length>0;if(!c&&!l){e=!1;const d=document.querySelector(".pet-drop-container");if(d){const u=d.querySelector(".mensagem-erro");u&&(u.style.display="block")}}return e}function gt(e,t=!1){return new Promise((o,a)=>{const n=document.querySelector('input[name="__RequestVerificationToken"]'),s=n?n.value:"",i=new XMLHttpRequest;i.open("POST","/admin/pets/SalvarPet"),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.upload.onprogress=function(r){r.lengthComputable&&r.loaded/r.total*100},i.onload=function(){if(i.status>=200&&i.status<300)try{const r=JSON.parse(i.responseText);r.sucesso?(t?toastr.success("Rascunho salvo com sucesso!"):toastr.success("Pet salvo com sucesso!"),ie(),$("#modalPet").modal("hide"),setTimeout(()=>{window.location.reload()},1500),o(r)):(console.error("Erro ao salvar pet:",r),r.erros?Object.keys(r.erros).forEach(c=>{const l=r.erros[c],d=document.getElementById(c);if(d){const u=d.nextElementSibling;u&&u.classList.contains("mensagem-erro")&&(u.textContent=l,u.style.display="block")}toastr.error(l)}):toastr.error(r.mensagem||"Erro ao salvar o pet"),a(new Error(r.mensagem||"Erro ao salvar")))}catch(r){console.error("Erro ao analisar resposta:",r);let c="Falha ao processar a resposta do servidor";try{const l=JSON.parse(i.responseText);l.mensagem&&(c=l.mensagem)}catch(l){console.error("Erro ao analisar resposta de erro:",l)}a(new Error(c))}else{console.error("Erro HTTP:",i.status,i.responseText);let r="Erro ao salvar. Por favor, tente novamente.";try{const c=JSON.parse(i.responseText);c.message&&(r=c.message)}catch{}toastr.error(r),a(new Error(`Erro HTTP: ${i.status} - ${r}`))}},i.onerror=function(){toastr.error("Erro de conexão. Por favor, verifique sua internet e tente novamente."),a(new Error("Erro de conexão"))},s&&e.append("__RequestVerificationToken",s),i.send(e)})}function Fa(){const e=document.getElementById("dropArea"),t=document.getElementById("fotoPet"),o=document.getElementById("previewImagem"),a=document.getElementById("btnRemoverImagem"),n=document.querySelector(".mensagem-soltar"),s=document.querySelector(".progresso-upload");if(!e||!t||!o){console.error("Elementos de upload não encontrados");return}function i(c){c.preventDefault(),c.stopPropagation()}["dragenter","dragover","dragleave","drop"].forEach(c=>{e.addEventListener(c,i,!1)}),["dragenter","dragover"].forEach(c=>{e.addEventListener(c,function(){e.classList.add("drag-over")},!1)}),["dragleave","drop"].forEach(c=>{e.addEventListener(c,function(){e.classList.remove("drag-over")},!1)}),e.addEventListener("drop",function(c){const d=c.dataTransfer.files;d.length&&(t.files=d,r(d[0]))},!1),e.addEventListener("click",function(){t.click()}),t.addEventListener("change",function(){this.files&&this.files[0]&&r(this.files[0])});async function r(c){if(c.size>10485760){toastr.error("O arquivo é muito grande. O tamanho máximo é 10MB.","Erro de upload");return}if(!c.type.match("image.*")){toastr.error("O arquivo selecionado não é uma imagem.","Erro de upload");return}try{n.style.display="none",s.style.display="flex";const d=new FileReader;d.onload=function(u){s.style.display="none",o.src=u.target.result,o.style.display="block",a.style.display="block"},d.readAsDataURL(c)}catch(d){console.error("Erro ao processar a imagem:",d),s.style.display="none",n.style.display="flex",toastr.error("Erro ao processar a imagem. Por favor, tente novamente.","Erro")}}a&&a.addEventListener("click",function(c){c.preventDefault(),c.stopPropagation(),t.value="",o.style.display="none",o.src="",a.style.display="none",n.style.display="flex"})}function Te(e){ie();const t=document.querySelector(`.cartao-pet[data-id="${e}"]`);if(t){const o=JSON.parse(t.getAttribute("data-json")),a=o.Status?.toLowerCase();if(a==="em processo"||a==="adotado"){toastr.warning(`Não é possível editar um pet ${a==="em processo"?"em processo de adoção":"já adotado"}.`);return}document.getElementById("petId").value=o.Id,document.getElementById("nomePet").value=o.Nome||"",document.getElementById("especiePet").value=o.Especie||"",document.getElementById("racaPet").value=o.Raca||"",document.getElementById("sexoPet").value=o.Sexo||"",document.getElementById("portePet").value=o.Porte||"",document.getElementById("anosPet").value=o.Anos||0,document.getElementById("mesesPet").value=o.Meses||0,document.getElementById("descricaoPet").value=o.Descricao||"",document.getElementById("statusPet").value=o.Status||"Disponível";const n=o.Descricao||"";if(document.getElementById("contadorCaracteres").textContent=n.length,o.NomeArquivoImagem){const s=document.getElementById("previewImagem");s.src=`/imagens/pets/${o.NomeArquivoImagem}`,s.style.display="block",document.getElementById("btnRemoverImagem").style.display="block",document.querySelector(".mensagem-soltar").style.display="none"}j(),document.getElementById("tituloCadastroEdicao").textContent="Editar Pet",Q?Q.show():console.error("Modal não inicializado")}else console.error(`Pet card não encontrado para ID: ${e}`),toastr.error("Não foi possível carregar os dados do pet para edição.")}function te(e){const t=document.querySelector(`.cartao-pet[data-id="${e}"]`);if(t){const o=JSON.parse(t.getAttribute("data-json"));document.getElementById("detalhePetId").value=o.Id,document.getElementById("nomeDetalhes").textContent=o.Nome||"Nome não informado",document.getElementById("especieDetalhes").textContent=o.Especie||"Não informado",document.getElementById("racaDetalhes").textContent=o.Raca||"Não informado";let a="";o.Anos>0&&o.Meses>0?a=`${o.Anos} ano(s) e ${o.Meses} mês(es)`:o.Anos>0?a=`${o.Anos} ano(s)`:o.Meses>0?a=`${o.Meses} mês(es)`:a="0 ano(s)",document.getElementById("idadeDetalhes").textContent=a;const n=document.getElementById("pet-status-badge"),s=o.Status?o.Status.toLowerCase().replace(" ","_"):"indisponivel";n.textContent=o.Status||"Indisponível",n.className="pet-status-badge",n.classList.add(s),document.getElementById("especieDetalhesInfo").textContent=o.Especie||"Não informado",document.getElementById("racaDetalhesInfo").textContent=o.Raca||"Não informado",document.getElementById("idadeDetalhesInfo").textContent=a,document.getElementById("statusDetalhesInfo").textContent=o.Status||"Não informado";const i=document.getElementById("sexoDetalhesContainer"),r=document.getElementById("porteDetalhesContainer");o.Sexo?(document.getElementById("sexoDetalhesInfo").textContent=o.Sexo,i.style.display="flex"):i.style.display="none",o.Porte?(document.getElementById("porteDetalhesInfo").textContent=o.Porte,r.style.display="flex"):r.style.display="none",document.getElementById("descricaoDetalhes").textContent=o.Descricao||"Sem descrição disponível";const c=document.getElementById("datasCadastroContainer"),l=document.getElementById("dataAtualizacaoContainer"),d=f=>{if(!f)return"Não disponível";try{return new Date(f).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(v){return console.error("Erro ao formatar data:",v),"Formato inválido"}};o.DataCadastro?(document.getElementById("dataCadastroInfo").textContent=d(o.DataCadastro),c.style.display="block"):c.style.display="none",o.DataAtualizacao?(document.getElementById("dataAtualizacaoInfo").textContent=d(o.DataAtualizacao),l.style.display="flex"):l.style.display="none";const u=document.getElementById("imgPetDetalhes");o.NomeArquivoImagem?u.src=`/imagens/pets/${o.NomeArquivoImagem}`:u.src="/imagens/pets/pet-placeholder.jpg",k?k.show():console.error("Modal de detalhes não inicializado")}else console.error(`Não foi possível encontrar o pet com ID ${e}`),fetch(`/admin/pets/detalhes/${e}`).then(o=>{if(!o.ok)throw new Error(`Erro ao carregar detalhes do pet: ${o.status}`);return o.json()}).then(o=>{if(o&&o.sucesso){const a=o.dados||o;za(a)}else toastr.error("Não foi possível carregar os detalhes do pet.")}).catch(o=>{console.error("Erro ao buscar dados do pet:",o),toastr.error("Erro ao carregar detalhes do pet. Por favor, tente novamente.")})}function za(e){document.getElementById("detalhePetId").value=e.Id,document.getElementById("nomeDetalhes").textContent=e.Nome||"Nome não informado",document.getElementById("especieDetalhes").textContent=e.Especie||"Não informado",document.getElementById("racaDetalhes").textContent=e.Raca||"Não informado";let t="";e.Anos>0&&e.Meses>0?t=`${e.Anos} ano(s) e ${e.Meses} mês(es)`:e.Anos>0?t=`${e.Anos} ano(s)`:e.Meses>0?t=`${e.Meses} mês(es)`:t="0 ano(s)",document.getElementById("idadeDetalhes").textContent=t;const o=document.getElementById("pet-status-badge"),a=e.Status?e.Status.toLowerCase().replace(" ","_"):"indisponivel";o.textContent=e.Status||"Indisponível",o.className="pet-status-badge",o.classList.add(a),document.getElementById("especieDetalhesInfo").textContent=e.Especie||"Não informado",document.getElementById("racaDetalhesInfo").textContent=e.Raca||"Não informado",document.getElementById("idadeDetalhesInfo").textContent=t,document.getElementById("statusDetalhesInfo").textContent=e.Status||"Não informado";const n=document.getElementById("sexoDetalhesContainer"),s=document.getElementById("porteDetalhesContainer");e.Sexo?(document.getElementById("sexoDetalhesInfo").textContent=e.Sexo,n.style.display="flex"):n.style.display="none",e.Porte?(document.getElementById("porteDetalhesInfo").textContent=e.Porte,s.style.display="flex"):s.style.display="none",document.getElementById("descricaoDetalhes").textContent=e.Descricao||"Sem descrição disponível";const i=document.getElementById("datasCadastroContainer"),r=document.getElementById("dataAtualizacaoContainer"),c=d=>{if(!d)return"Não disponível";try{return new Date(d).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(u){return console.error("Erro ao formatar data:",u),"Formato inválido"}};e.DataCadastro?(document.getElementById("dataCadastroInfo").textContent=c(e.DataCadastro),i.style.display="block"):i.style.display="none",e.DataAtualizacao?(document.getElementById("dataAtualizacaoInfo").textContent=c(e.DataAtualizacao),r.style.display="flex"):r.style.display="none";const l=document.getElementById("imgPetDetalhes");e.NomeArquivoImagem?l.src=`/imagens/pets/${e.NomeArquivoImagem}`:l.src="/imagens/pets/pet-placeholder.jpg",k?k.show():console.error("Modal de detalhes não inicializado")}function Ra(){const e=document.getElementById("descricaoPet"),t=document.getElementById("contadorCaracteres");if(e&&t){const o=e.value||"";t.textContent=o.length,o.length>450?t.classList.add("text-warning"):t.classList.remove("text-warning")}}function j(){const e=parseInt(document.getElementById("anosPet").value)||0,t=parseInt(document.getElementById("mesesPet").value)||0,o=document.getElementById("idadeTotal");if(o){let a=`<i class="fas fa-info-circle me-1"></i>Idade total: ${e} ano(s)`;t>0&&(a+=` e ${t} mês(es)`),o.innerHTML=a}}function oe(){document.querySelectorAll(".imagem-pet").forEach(e=>{e.addEventListener("error",function(){this.style.display="none";const t=this.closest(".container-imagem");if(t)if(t.querySelector(".sem-imagem"))t.querySelector(".sem-imagem").style.display="flex";else{const o=document.createElement("div");o.className="sem-imagem",t.appendChild(o)}})})}function vt(){setTimeout(()=>{const e=document.querySelectorAll(".imagem-pet");if(e.length===0)return;let t={};try{const s=sessionStorage.getItem("imagensPets");if(s){t=JSON.parse(s);for(const i in t){const r=document.querySelector(`.cartao-pet[data-id="${i}"]`);if(!r)continue;const c=r.querySelector(".imagem-pet");if(!c)continue;c.src=t[i],c.setAttribute("data-loaded","true"),c.style.display="block";const l=r.querySelector(".sem-imagem");l&&(l.style.display="none")}}}catch(s){console.error("Erro ao recuperar cache de imagens:",s)}let o=0;const a=e.length,n=()=>{$(".pets-grid").addClass("layout-pronto")};setTimeout(n,3e3),e.forEach(s=>{if(s.complete&&s.naturalWidth>0&&s.style.display!=="none"){o++,s.setAttribute("data-loaded","true"),o>=a&&n();return}const i=new Image,r=setTimeout(()=>{o++,s.style.display="none";const c=s.closest(".container-imagem");if(c)if(c.querySelector(".sem-imagem"))c.querySelector(".sem-imagem").style.display="flex";else{const l=document.createElement("div");l.className="sem-imagem",c.appendChild(l)}o>=a&&n()},3e3);i.onload=function(){clearTimeout(r),o++,s.style.display="block",s.setAttribute("data-loaded","true");const c=s.closest(".cartao-pet")?.getAttribute("data-id");if(c)try{t[c]=s.src,sessionStorage.setItem("imagensPets",JSON.stringify(t))}catch{}o>=a&&n()},i.onerror=function(){clearTimeout(r),o++,s.style.display="none";const c=s.closest(".container-imagem");if(c)if(c.querySelector(".sem-imagem"))c.querySelector(".sem-imagem").style.display="flex";else{const l=document.createElement("div");l.className="sem-imagem",c.appendChild(l)}o>=a&&n()},i.src=s.src})},100)}function Oa(){const e=document.getElementById("pesquisaPet"),t=document.getElementById("filtroEspecie"),o=document.getElementById("filtroStatus");e&&(e.value=""),t&&(t.value=""),o&&(o.value=""),D(),toastr.info("Filtros limpos com sucesso!")}function D(){const e=(document.getElementById("pesquisaPet")?.value||"").toLowerCase(),t=(document.getElementById("filtroEspecie")?.value||"").toLowerCase(),o=(document.getElementById("filtroStatus")?.value||"").toLowerCase().replace(" ","_"),a=document.querySelectorAll(".cartao-pet");let n=0;a.forEach(r=>{const c=r.querySelector(".nome-pet")?.textContent.toLowerCase()||"",l=r.getAttribute("data-json")&&JSON.parse(r.getAttribute("data-json")).Descricao?.toLowerCase()||"",d=r.getAttribute("data-especie")?.toLowerCase()||"",u=r.getAttribute("data-status")?.toLowerCase()||"",f=r.getAttribute("data-json")&&JSON.parse(r.getAttribute("data-json")).Raca?.toLowerCase()||"";(e===""||c.includes(e)||l.includes(e)||f.includes(e))&&(t===""||d===t)&&(o===""||u===o)?(r.style.display="",n++):r.style.display="none"});const s=document.querySelector(".mensagem-sem-pets");s&&(s.style.display=n===0&&a.length>0?"block":"none");const i=document.querySelector(".info-paginacao");i&&(i.innerHTML=`Exibindo <span>${n}</span> de <span>${a.length}</span> pets`),$(".paginacao-container").css("display","block"),$(".paginacao-info").css("display","flex"),$(".itens-por-pagina").css("display","flex")}function ie(){const e=document.getElementById("formPet");e&&e.reset();const t=document.getElementById("petId");t&&(t.value="0");const o=document.getElementById("previewImagem"),a=document.getElementById("btnRemoverImagem"),n=document.querySelector(".mensagem-soltar");o&&(o.style.display="none",o.src=""),a&&(a.style.display="none"),n&&(n.style.display="flex");const s=document.getElementById("contadorCaracteres");s&&(s.textContent="0"),j();const i=document.getElementById("tituloCadastroEdicao");i&&(i.textContent="Novo Pet");const r=document.getElementById("statusPet");r&&(r.value="Disponível"),document.querySelectorAll(".mensagem-erro").forEach(c=>{c.style.display="none"})}function Ha(e){const t=document.querySelector(`.cartao-pet[data-id="${e}"]`);if(t){const o=JSON.parse(t.getAttribute("data-json")),a=o.Status?.toLowerCase();if(a==="em processo"||a==="adotado"){toastr.warning(`Não é possível excluir um pet ${a==="em processo"?"em processo de adoção":"já adotado"}.`);return}document.getElementById("petIdParaExcluir").value=e,document.getElementById("nomePetExclusao").textContent=o.Nome,A?A.show():console.error("Modal de confirmação não inicializado")}}function _a(e){if(!e){toastr.error("ID do pet inválido");return}A&&A.hide();const t=new XMLHttpRequest;t.open("POST",`/admin/pets/excluir/${e}`),t.setRequestHeader("X-Requested-With","XMLHttpRequest");const o=document.querySelector('input[name="__RequestVerificationToken"]'),a=o?o.value:"";a&&t.setRequestHeader("RequestVerificationToken",a),t.onload=function(){if(t.status>=200&&t.status<300)try{const n=JSON.parse(t.responseText);if(n.sucesso){toastr.success("Pet excluído com sucesso!");const s=document.querySelector(`.cartao-pet[data-id="${e}"]`);s&&s.remove(),setTimeout(()=>{window.location.reload()},1500)}else toastr.error(n.mensagem||"Erro ao excluir pet")}catch(n){console.error("Erro ao processar resposta:",n),toastr.error("Erro ao processar resposta do servidor")}else toastr.error(`Erro ao excluir pet: ${t.status}`)},t.onerror=function(){toastr.error("Erro de conexão ao tentar excluir o pet")},t.send()}function Ua(){const e=document.getElementById("nomePet"),t=document.getElementById("petId");if(e){let o;e.addEventListener("blur",async function(){const a=e.value.trim(),n=t?t.value:0;if(a.length>0)try{const i=await(await fetch(`/admin/pets/verificar-nome?nome=${encodeURIComponent(a)}&id=${n}`)).json();if(i.disponivel){e.classList.remove("is-invalid");const r=e.parentElement.querySelector(".mensagem-erro");r&&(r.style.display="none")}else{e.classList.add("is-invalid");const r=e.parentElement.querySelector(".mensagem-erro");r&&(r.textContent=i.mensagem,r.style.display="block")}}catch(s){console.error("Erro ao verificar nome:",s)}}),e.addEventListener("input",function(){clearTimeout(o),o=setTimeout(async function(){const a=e.value.trim(),n=t?t.value:0;if(a.length>2)try{const i=await(await fetch(`/admin/pets/verificar-nome?nome=${encodeURIComponent(a)}&id=${n}`)).json();if(i.disponivel){e.classList.remove("is-invalid");const r=e.parentElement.querySelector(".mensagem-erro");r&&(r.style.display="none")}else{e.classList.add("is-invalid");const r=e.parentElement.querySelector(".mensagem-erro");r&&(r.textContent=i.mensagem,r.style.display="block")}}catch(s){console.error("Erro ao verificar nome:",s)}},500)})}}function ja(){const e=document.getElementById("btnLimparFiltros");e&&e.addEventListener("click",Oa);const t=document.getElementById("pesquisaPet"),o=document.getElementById("filtroEspecie"),a=document.getElementById("filtroStatus");t&&t.addEventListener("input",D),o&&o.addEventListener("change",D),a&&a.addEventListener("change",D),document.querySelectorAll(".botao-acao").forEach(u=>{u.addEventListener("click",function(f){f.preventDefault(),f.stopPropagation();const v=this.getAttribute("data-pet-id");v&&(this.classList.add("clicked"),setTimeout(()=>this.classList.remove("clicked"),200),this.classList.contains("visualizar")?te(v):this.classList.contains("editar")?Te(v):this.classList.contains("excluir")&&Ha(v))})}),document.querySelectorAll(".cartao-pet").forEach(u=>{u.addEventListener("click",function(f){if(f.target.closest(".botao-acao"))return;const v=this.getAttribute("data-id");v&&te(v)})});const n=document.getElementById("btnConfirmarExclusao");n&&n.addEventListener("click",function(){const u=document.getElementById("petIdParaExcluir");u&&u.value?_a(parseInt(u.value)):(console.error("ID não encontrado para exclusão"),toastr.error("Erro: ID do pet não encontrado"))});const s=document.querySelector(".btnEditarPet");s&&s.addEventListener("click",function(){const u=document.getElementById("detalhePetId").value;u&&(k.hide(),setTimeout(()=>{Te(u)},500))});const i=document.getElementById("btnSalvarPet"),r=document.getElementById("btnSalvarRascunho");i&&i.addEventListener("click",Ma),r&&r.addEventListener("click",Na);const c=document.getElementById("descricaoPet");c&&c.addEventListener("input",Ra);const l=document.getElementById("anosPet"),d=document.getElementById("mesesPet");l&&l.addEventListener("input",j),d&&d.addEventListener("input",j)}function ae(){document.querySelectorAll(".cartao-pet").forEach(e=>{const t=e.getAttribute("data-status");if(t==="em_processo"||t==="adotado"){const o=e.querySelector(".botao-acao.editar"),a=e.querySelector(".botao-acao.excluir");if(o){const n=t==="em_processo"?"Não é possível editar um pet em processo de adoção":"Não é possível editar um pet já adotado";o.removeAttribute("title"),o.disabled=!0,o.classList.add("desabilitado");const s=document.createElement("div");s.className="tooltip-personalizado";const i=document.createElement("span");i.className="tooltip-texto",i.textContent=n,o.parentNode.insertBefore(s,o),s.appendChild(o),s.appendChild(i)}if(a){const n=t==="em_processo"?"Não é possível excluir um pet em processo de adoção":"Não é possível excluir um pet já adotado";a.removeAttribute("title"),a.disabled=!0,a.classList.add("desabilitado");const s=document.createElement("div");s.className="tooltip-personalizado";const i=document.createElement("span");i.className="tooltip-texto",i.textContent=n,a.parentNode.insertBefore(s,a),s.appendChild(a),s.appendChild(i)}}})}function Va(){document.querySelectorAll(".modal").forEach(t=>{t.addEventListener("show.bs.modal",function(){K()}),t.addEventListener("hidden.bs.modal",function(){K(),document.querySelectorAll(".modal.show").length>0&&document.body.classList.add("modal-open")})});const e=document.getElementById("btnNovoPet");e&&e.addEventListener("click",ie)}function Wa(){new MutationObserver(function(){$(".paginacao-container").css("display","block"),$(".paginacao-info").css("display","flex"),$(".itens-por-pagina").css("display","flex")}).observe(document.body,{childList:!0,subtree:!0}),document.querySelectorAll(".pagination .page-link").forEach(t=>{t.addEventListener("click",function(o){o.preventDefault();var a=this.getAttribute("href");return a&&(window.location.href=a),!1})}),document.addEventListener("click",function(t){if(t.target.matches(".pagination .page-link")||t.target.closest(".pagination .page-link")){t.preventDefault();var o=t.target.matches(".pagination .page-link")?t.target:t.target.closest(".pagination .page-link"),a=o.getAttribute("href");return a&&(window.location.href=a),!1}})}function Ya(){qa(),Wa(),ft(),$(window).on("load",function(){typeof oe=="function"&&oe(),typeof ee=="function"&&ee(),setTimeout(()=>{$(".pets-grid").addClass("layout-pronto")},200)}),$(".imagem-pet").on("load",function(){$(this).attr("data-loaded","true"),$(this).css("display","block");const e=$(this).closest(".container-imagem");e.find(".sem-imagem").length&&e.find(".sem-imagem").hide();const t=$(this).closest(".cartao-pet").attr("data-id");if(t)try{const o=JSON.parse(sessionStorage.getItem("imagensPets")||"{}");o[t]=$(this).attr("src"),sessionStorage.setItem("imagensPets",JSON.stringify(o))}catch{}})}function Ga(){typeof configurarEventosFiltro=="function"&&configurarEventosFiltro(),typeof ae=="function"&&ae()}let Ja={closeButton:!0,progressBar:!0,positionClass:"toast-top-right",timeOut:5e3};const Xa="/admin/adocoes/ObterPerfilUsuario",Za="/admin/adocoes/ObterEstatisticasAdocaoUsuario",Qa="/admin/adocoes/ObterHistoricoAdocoesUsuario";$(document).ready(function(){toastr.options=Ja,Ka(),en(),$(document).on("click",".pagination .page-link",function(e){e.preventDefault();var t=$(this).attr("href");return t&&(window.location.href=t),!1})});function Ka(){$("#pesquisaAdocao").on("keyup",function(){F()}),$("#filtroStatus").on("change",function(){F()}),$("#filtroData").on("change",function(){F()}),$("#btnLimparFiltros").on("click",function(){an()}),$(".botao-ver-perfil").on("click",function(){const e=$(this).data("usuario-id");cn(e)}),$("#modalDetalhesAdocao").on("hidden.bs.modal",function(){$(".carregando-detalhes").show(),$(".detalhes-adocao-container").hide(),$("#detalhesNomePet, #detalhesEspeciePet, #detalhesRacaPet, #detalhesIdadePet, #detalhesSexoPet, #detalhesPortePet").text("-"),$("#detalhesStatusAdocao, #detalhesDataEnvio, #detalhesDataResposta").text("-"),$("#detalhesNomeAdotante, #detalhesEmailAdotante, #detalhesTelefoneAdotante, #detalhesCpfAdotante").text("-"),$("#detalhesObservacoes").html(""),$(".timeline-progresso-item").removeClass("ativo concluido atual rejeitado"),$(".timeline-progresso-linha").removeClass("ativa"),$("#timelineDataSolicitacao, #timelineDataAprovacao, #timelineDataBusca, #timelineDataFinalizacao").text(""),$("#detalhesDataBuscaContainer, #detalhesDataFinalizacaoContainer").hide(),$("#detalhesPrazoBusca").hide(),$("#detalhesPetImagem").html('<i class="fas fa-paw"></i>'),$("#detalhesAdotanteAvatar").html('<i class="fas fa-user"></i>')}),$("#modalDetalhesAdocao").on("shown.bs.modal",function(){setTimeout(function(){mn()},200)}),$(document).on("click",".detalhes-aba",function(e){e.preventDefault();const t=$(this).data("painel");$(".detalhes-aba").removeClass("ativa"),$(this).addClass("ativa"),$(".detalhes-painel").removeClass("ativo"),$("#"+t).addClass("ativo")})}function en(){$(".tabela tr").each(function(){const e=$(this).find(".indicador-status").text().trim();tn($(this).find(".indicador-status"),e)})}function tn(e,t){switch(e.removeClass("pendente aprovado finalizada rejeitada cancelada em-processo aguardando-buscar"),t.toLowerCase()){case"pendente":e.addClass("pendente");break;case"aprovado":e.addClass("aprovado");break;case"finalizada":e.addClass("finalizada");break;case"rejeitada":e.addClass("rejeitada");break;case"cancelada":e.addClass("cancelada");break;case"em processo":e.addClass("em-processo");break;case"aguardando buscar":e.addClass("aguardando-buscar");break}}function F(){const e=$("#pesquisaAdocao").val().toLowerCase(),t=$("#filtroStatus").val(),o=$("#filtroData").val();let a=!1;$(".tabela tbody tr").each(function(){const n=$(this),s=n.text().toLowerCase(),i=n.data("status"),r=new Date(n.find("td:nth-child(3) span:first").text().split("/").reverse().join("-"));let c=s.indexOf(e)>-1,l=t==="Todos"||i===t,d=on(r,o);c&&l&&d?(n.show(),a=!0):n.hide()}),a?($(".tabela").show(),$(".mensagem-sem-adocoes").hide()):($(".tabela").hide(),$(".mensagem-sem-adocoes").show())}function on(e,t){if(!t)return!0;const o=new Date;switch(t){case"hoje":return e.toDateString()===o.toDateString();case"7dias":const a=new Date;return a.setDate(o.getDate()-7),e>=a;case"30dias":const n=new Date;return n.setDate(o.getDate()-30),e>=n;default:return!0}}function an(){$("#pesquisaAdocao").val(""),$("#filtroStatus").val("Todos"),$("#filtroData").val(""),F()}function nn(e){return e?(e=e.replace(/\D/g,""),e.length===11?e.replace(/^(\d{2})(\d{5})(\d{4})$/,"($1) $2-$3"):e.replace(/^(\d{2})(\d{4})(\d{4})$/,"($1) $2-$3")):"-"}function sn(e){return e?(e=e.replace(/\D/g,""),e.replace(/^(\d{3})(\d{3})(\d{3})(\d{2})$/,"$1.$2.$3-$4")):"-"}function rn(e){return e?(e=e.replace(/\D/g,""),e.replace(/^(\d{5})(\d{3})$/,"$1-$2")):"-"}function cn(e){$("#spinnerPerfilUsuario").show(),$("#conteudoPerfilUsuario").hide(),$.ajax({url:Xa,type:"GET",data:{id:e},success:function(t){t?ln(t):toastr.error("Não foi possível carregar os dados do usuário")},error:function(t,o,a){toastr.error("Erro ao carregar perfil: "+a)}}),$.ajax({url:Za,type:"GET",data:{id:e},success:function(t){dn(t)}}),$.ajax({url:Qa,type:"GET",data:{id:e},success:function(t){un(t)}})}function ln(e){const t=document.getElementById("perfilUsuarioNome"),o=document.getElementById("perfilUsuarioEmail"),a=document.getElementById("perfilUsuarioInicial"),n=document.querySelector(".perfil-foto-container");t.textContent=e.nome||"Nome não disponível",o.textContent=e.email||"Email não disponível";const s=n.querySelector("img");if(s&&s.remove(),e.fotoPerfil){a.style.display="none";const r=document.createElement("img");r.src=`/imagens/perfil/${e.fotoPerfil}`,r.alt=e.nome,r.className="perfil-foto",n.appendChild(r)}else a.style.display="flex",a.textContent=e.nome?e.nome.charAt(0):"U";if($("#nomeCompletoUsuario").text(e.nome||"-"),$("#emailUsuario").text(e.email||"-"),$("#cpfUsuario").text(sn(e.cpf)),$("#telefoneUsuario").text(nn(e.telefone)),e.dataNascimento){const r=new Date(e.dataNascimento);$("#dataNascimentoUsuario").text(r.toLocaleDateString("pt-BR"));const c=new Date;let l=c.getFullYear()-r.getFullYear();const d=c.getMonth()-r.getMonth();(d<0||d===0&&c.getDate()<r.getDate())&&l--,$("#idadeUsuario").text(l+" anos")}else $("#dataNascimentoUsuario").text("-"),$("#idadeUsuario").text("-");if(e.dataCadastro){const r=new Date(e.dataCadastro);$("#dataCadastroUsuario").text(r.toLocaleDateString("pt-BR"))}else $("#dataCadastroUsuario").text("-");$("#logradouroUsuario").text(e.logradouro||"-"),$("#numeroUsuario").text(e.numero||"-"),$("#bairroUsuario").text(e.bairro||"-"),$("#complementoUsuario").text(e.complemento||"-"),$("#cepUsuario").text(rn(e.cep)),$("#cidadeUsuario").text(e.cidade||"-"),$("#estadoUsuario").text(e.estado||"-"),$("#spinnerPerfilUsuario").hide(),$("#conteudoPerfilUsuario").show(),new bootstrap.Modal(document.getElementById("perfilUsuarioModal")).show()}function dn(e){$("#estatisticaTotal").text(e.total||0),$("#estatisticaAprovadas").text(e.aprovadas||0),$("#estatisticaRejeitadas").text(e.rejeitadas||0),$("#estatisticaCanceladas").text(e.canceladas||0),$("#estatisticaExpiradas").text(e.expiradas||0)}function un(e,t){const o=$("#historicoAdocoesUsuarioContainer");if(o.empty(),!e||e.length===0){o.html(`
            <div class="text-center py-4">
                <i class="fas fa-heart-broken fa-3x text-muted mb-3"></i>
                <p class="mb-0">Este usuário ainda não realizou nenhuma adoção.</p>
            </div>
        `);return}const a=$('<div class="historico-adocoes-container"></div>');e.forEach(function(n){const s=new Date(n.dataAdocao).toLocaleDateString("pt-BR");let i="";switch(n.status.toLowerCase()){case"aprovado":case"finalizada":case"aguardando buscar":i="aprovado";break;case"rejeitada":i="rejeitada";break;case"cancelada":i="cancelada";break;default:i="pendente"}const r=$(`
            <div class="historico-adocao-item">
                <div class="historico-pet-img-container">
                    ${n.imagemPet?`<img src="${n.imagemPet}" alt="${n.nomePet}" class="historico-pet-img">`:'<div class="historico-default-img"><i class="fas fa-paw"></i></div>'}
                </div>
                <div class="historico-pet-info">
                    <div class="historico-pet-nome">${n.nomePet||"Pet não identificado"}</div>
                    <div class="historico-pet-data">
                        <span class="badge ${i}">${n.status}</span>
                        <span><i class="far fa-calendar-alt me-1"></i>${s}</span>
                    </div>
                </div>
                <div class="historico-acoes">
                    <button class="btn btn-sm btn-outline-primary" 
                            onclick="verDetalhes(${n.id}, true)" 
                            title="Ver detalhes da adoção">
                        <i class="fas fa-eye me-1"></i> Detalhes
                    </button>
                </div>
            </div>
        `);a.append(r)}),o.append(a)}function mn(){if($(".detalhes-aba").off("click"),$(".detalhes-aba").on("click",function(e){e.preventDefault(),e.stopPropagation();const t=$(this).data("painel");$(".detalhes-aba").removeClass("ativa"),$(this).addClass("ativa"),$(".detalhes-painel").removeClass("ativo").hide(),$("#"+t).addClass("ativo").show()}),$(".detalhes-aba.ativa").length===0&&$(".detalhes-aba").length>0){$(".detalhes-aba").first().addClass("ativa");const e=$(".detalhes-aba").first().data("painel");$(".detalhes-painel").removeClass("ativo").hide(),$("#"+e).addClass("ativo").show()}setTimeout(function(){$(".detalhes-aba.ativa").trigger("click")},50)}window.alternarMenu=He||T;window.abrirMenuLateral=Oe||kt;window.fecharMenuLateral=R||Ue;window.realizarLogout=_e;window.togglePainelNotificacoes=Ne;window.mostrarPainelNotificacoes=Me;window.ocultarPainelNotificacoes=P;window.carregarNotificacoes=ze;window.marcarTodasComoLidas=Re;
